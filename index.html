<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ProClean - Profesyonel Çamaşırhane Yönetim Sistemi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
            --text: #2c3e50;
            --bg: #f5f7fa;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --border-radius: 12px;
        }
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        }
        
        html, body { 
            height: 100%; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        body { 
            color: var(--text); 
            height: 100vh; 
            overflow: hidden; 
            padding: 10px;
        }
        /* Desktop App Container */
        .desktop-window {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            height: calc(100vh - 20px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        .window-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .window-controls {
            display: flex;
            gap: 8px;
        }
        .control-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }
        .control-btn.close { background: #ff5f57; }
        .control-btn.minimize { background: #ffbd2e; }
        .control-btn.maximize { background: #28ca42; }
        /* Login Screen */
        .login-container { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%); 
        }
        
        .login-form { 
            background: white; 
            padding: 3rem; 
            border-radius: var(--border-radius); 
            box-shadow: var(--shadow); 
            width: 100%; 
            max-width: 450px; 
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .login-form h1 { 
            text-align: center; 
            margin-bottom: 2rem; 
            color: var(--primary); 
            font-size: 2rem;
        }
        
        .form-group { 
            margin-bottom: 1.5rem; 
        }
        
        .form-group label { 
            display: block; 
            margin-bottom: 0.5rem; 
            font-weight: 600; 
            color: var(--dark);
        }
        
        .form-group input { 
            width: 100%; 
            padding: 1rem; 
            border: 2px solid #ddd; 
            border-radius: 8px; 
            font-size: 1rem; 
            transition: all 0.3s;
        }
        .form-group input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        .btn { 
            padding: 0.8rem 1.5rem; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 1rem; 
            font-weight: 600; 
            transition: all 0.3s; 
            display: inline-block; 
            text-align: center; 
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, var(--secondary), #2980b9); 
            color: #fff; 
            width: 100%;
        }
        
        .btn-primary:hover { 
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }
        /* Main App */
        .app-container { 
            display: none; 
            flex-direction: column; 
            height: 100%; 
        }
        .app-header { 
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%); 
            color: white; 
            padding: 1rem 1.5rem; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        .app-title { 
            font-size: 1.5rem; 
            font-weight: 700; 
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .user-info { 
            display: flex; 
            align-items: center; 
            gap: 1rem; 
        }
        .user-info .status-indicator {
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(46, 204, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }
        .user-info button {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
            background: var(--accent);
            color: white;
            min-width: 120px;
        }
        
        .user-info button:hover { 
            background: #c0392b; 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        /* Tabs */
        .tabs { 
            display: flex; 
            background: var(--dark); 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .tab { 
            padding: 1rem 2rem; 
            color: white; 
            cursor: pointer; 
            font-weight: 500; 
            border-bottom: 3px solid transparent; 
            font-size: 0.95rem; 
            transition: all 0.3s;
            position: relative;
        }
        .tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: var(--secondary);
            transition: width 0.3s;
        }
        .tab:hover::after {
            width: 100%;
        }
        
        .tab.active { 
            background: var(--light); 
            color: var(--primary); 
            border-bottom: 3px solid var(--secondary); 
        }
        .tab.active::after {
            width: 100%;
        }
        /* Content */
        .tab-content { 
            flex-grow: 1; 
            padding: 1.5rem; 
            overflow: hidden; 
            background: var(--bg);
        }
        
        .tab-pane { 
            display: none; 
            height: calc(100vh - 250px); 
            overflow: auto; 
        }
        
        .tab-pane.active { 
            display: block; 
        }
        /* Enhanced Cards */
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }
        .packaging-header { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 1.5rem; 
            padding-bottom: 1rem; 
            border-bottom: 2px solid #eee; 
            align-items: center; 
        }
        
        .customer-info { 
            display: flex; 
            gap: 1rem; 
            align-items: center; 
            flex-wrap: wrap; 
        }
        
        .info-group { 
            display: flex; 
            flex-direction: column; 
            margin-bottom: 0; 
        }
        
        .info-group label { 
            font-weight: 600; 
            margin-bottom: 0.3rem; 
            font-size: 0.85rem; 
            color: var(--dark);
        }
        
        .info-group select, .info-group input { 
            padding: 0.6rem; 
            border: 2px solid #ddd; 
            border-radius: 8px; 
            font-size: 0.9rem; 
            transition: all 0.3s;
        }
        .info-group select:focus, .info-group input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        .packaging-content {
            display: flex;
            gap: 1.5rem;
            align-items: flex-start;
            padding-bottom: 20px;
        }
        .barcode-section, .pending-packages, .package-details {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: all 0.3s;
        }
        .barcode-section:hover, .pending-packages:hover, .package-details:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }
        
        .barcode-section { 
            flex: 0 0 25%; 
            min-width: 250px; 
        }
        
        .pending-packages { 
            flex: 0 0 50%; 
            min-width: 400px; 
            overflow: auto; 
        }
        
        .package-details { 
            flex: 0 0 25%; 
            min-width: 250px; 
            display: flex; 
            flex-direction: column; 
        }
        /* Enhanced Input Styling */
        .barcode-input { 
            display: flex; 
            margin-bottom: 1rem; 
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .barcode-input input { 
            flex-grow: 1; 
            padding: 1rem; 
            border: 2px solid #ddd; 
            border-right: none;
            font-size: 1.1rem; 
            outline: none;
        }
        .barcode-input input:focus {
            border-color: var(--secondary);
        }
        
        .barcode-input button { 
            padding: 1rem 1.5rem; 
            border: 2px solid #ddd; 
            background: var(--secondary); 
            color: white;
            cursor: pointer; 
            transition: all 0.3s;
            font-weight: 600;
        }
        .barcode-input button:hover {
            background: #2980b9;
        }
        /* Enhanced Tables */
        .package-table { 
            width: 100%; 
            border-collapse: collapse; 
            font-size: 0.9rem; 
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .package-table th, .package-table td { 
            padding: 1rem; 
            text-align: left; 
            border-bottom: 1px solid #eee; 
        }
        
        .package-table th { 
            background: var(--primary); 
            color: white;
            font-weight: 600; 
        }
        
        .package-table tr:hover { 
            background: #f8f9fa; 
            transform: scale(1.01);
            transition: all 0.2s;
        }
        .package-table tr.selected {
            background-color: #e3f2fd !important;
            font-weight: bold;
        }
        .quick-buttons { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 0.8rem; 
            margin-top: 1rem; 
        }
        
        .quick-btn { 
            padding: 1rem; 
            background: var(--light); 
            border: 2px solid #ddd; 
            border-radius: 8px; 
            cursor: pointer; 
            text-align: center; 
            font-size: 0.9rem; 
            position: relative; 
            transition: all 0.3s;
            font-weight: 500;
        }
        .quick-btn:hover {
            background: var(--secondary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .quantity-badge { 
            position: absolute; 
            top: -8px; 
            right: -8px; 
            background: var(--accent); 
            color: white; 
            border-radius: 50%; 
            width: 24px; 
            height: 24px; 
            font-size: 0.8rem; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold;
            animation: bounce 0.5s;
        }
        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }
        /* Enhanced Buttons */
        .btn-success { 
            background: linear-gradient(135deg, var(--success), #27ae60); 
            color: white; 
        }
        
        .btn-warning { 
            background: linear-gradient(135deg, var(--warning), #e67e22); 
            color: white; 
        }
        
        .btn-danger { 
            background: linear-gradient(135deg, var(--accent), #c0392b); 
            color: white; 
        }
        .btn-success:hover, .btn-warning:hover, .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        /* Status Badges */
        .status-beklemede { 
            background: var(--warning); 
            color: white; 
            padding: 0.4rem 0.8rem; 
            border-radius: 20px; 
            font-size: 0.8rem; 
            font-weight: 600;
        }
        
        .status-sevk-edildi { 
            background: var(--success); 
            color: white; 
            padding: 0.4rem 0.8rem; 
            border-radius: 20px; 
            font-size: 0.8rem; 
            font-weight: 600;
        }
        /* Enhanced Footer */
        .app-footer { 
            background: var(--primary); 
            color: white; 
            padding: 1rem 1.5rem; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-size: 0.9rem; 
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }
        /* Enhanced Toast Notifications */
        .toast { 
            position: fixed; 
            top: 30px; 
            right: 30px; 
            padding: 1.5rem 2rem; 
            border-radius: var(--border-radius); 
            color: white; 
            z-index: 10000; 
            opacity: 0; 
            transform: translateX(400px); 
            transition: all 0.4s ease-out; 
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .toast.show { 
            opacity: 1; 
            transform: translateX(0); 
        }
        
        .toast.success { 
            background: linear-gradient(135deg, var(--success), #27ae60); 
        } 
        
        .toast.error { 
            background: linear-gradient(135deg, var(--accent), #c0392b); 
        } 
        
        .toast.warning { 
            background: linear-gradient(135deg, var(--warning), #e67e22); 
        }
        .toast.info {
            background: linear-gradient(135deg, var(--secondary), #2980b9);
        }
        /* Enhanced Modals */
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.6); 
            z-index: 10000; 
            justify-content: center; 
            align-items: center; 
            backdrop-filter: blur(5px);
        }
        
        .modal-content { 
            background: white; 
            padding: 2rem; 
            border-radius: var(--border-radius); 
            width: 90%; 
            max-width: 600px; 
            max-height: 80vh; 
            overflow-y: auto; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        @keyframes modalSlideIn {
            from { transform: scale(0.7); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .modal-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 1.5rem; 
            padding-bottom: 1rem; 
            border-bottom: 2px solid #eee; 
        }
        
        .modal-close { 
            background: none; 
            border: none; 
            font-size: 2rem; 
            cursor: pointer; 
            color: var(--dark);
            transition: all 0.3s;
        }
        .modal-close:hover {
            color: var(--accent);
            transform: rotate(90deg);
        }
        /* Offline Indicator */
        .offline-indicator { 
            position: fixed; 
            bottom: 30px; 
            left: 30px; 
            padding: 1rem 1.5rem; 
            background: var(--accent); 
            color: white; 
            border-radius: var(--border-radius); 
            z-index: 10000; 
            display: none; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideInLeft 0.5s ease-out;
        }
        @keyframes slideInLeft {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        .online-indicator {
            position: fixed;
            bottom: 30px;
            left: 30px;
            padding: 1rem 1.5rem;
            background: var(--success);
            color: white;
            border-radius: var(--border-radius);
            z-index: 10000;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        /* Loading Spinner */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10001;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Stock Status Classes */
        .status-kritik { 
            background: #c0392b; 
            color: #fff; 
            padding: 0.3rem 0.8rem; 
            border-radius: 15px; 
            font-size: 0.8rem; 
            font-weight: 600;
        }
        
        .status-az-stok { 
            background: #f39c12; 
            color: #fff; 
            padding: 0.3rem 0.8rem; 
            border-radius: 15px; 
            font-size: 0.8rem; 
            font-weight: 600;
        }
        
        .status-stokta { 
            background: #2ecc71; 
            color: #fff; 
            padding: 0.3rem 0.8rem; 
            border-radius: 15px; 
            font-size: 0.8rem; 
            font-weight: 600;
        }
        /* Enhanced Search */
        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }
        .search-input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: all 0.3s;
        }
        .search-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }
        /* Responsive Design */
        @media (max-width: 1200px) {
            .barcode-section, .package-details { 
                min-width: 220px; 
            }
            .pending-packages { 
                flex: 1 1 60%; 
            }
        }
        @media (max-width: 900px) {
            .packaging-content { 
                flex-direction: column; 
                height: auto; 
            }
            .barcode-section, .pending-packages, .package-details { 
                flex: 1 1 auto; 
                width: 100%; 
                min-width: auto; 
            }
            .tab-pane { 
                height: auto; 
            }
            .desktop-window {
                margin: 5px;
                height: calc(100vh - 10px);
                border-radius: 8px;
            }
            .window-header {
                border-radius: 8px 8px 0 0;
            }
        }
        @media (max-width: 600px) {
            .customer-info {
                flex-direction: column;
                align-items: flex-start;
            }
            .quick-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            .tabs {
                overflow-x: auto;
            }
            .tab {
                min-width: 120px;
            }
        }
        /* Print Styles */
        @media print {
            .desktop-window {
                box-shadow: none;
                margin: 0;
                height: auto;
            }
            .window-header, .tabs, .app-footer {
                display: none;
            }
            .tab-content {
                padding: 0;
            }
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
    </div>
    <!-- Desktop Window Container -->
    <div class="desktop-window">
        <!-- Window Header with Controls -->
        <div class="window-header">
            <div class="window-controls">
                <button class="control-btn close" onclick="showExitConfirmation()"></button>
                <button class="control-btn minimize" onclick="minimizeWindow()"></button>
                <button class="control-btn maximize" onclick="toggleMaximize()"></button>
            </div>
            <div class="app-title">
                <i class="fas fa-tshirt"></i>
                ProClean Management System
            </div>
            <div style="width: 60px;"></div> <!-- Spacer for centering -->
        </div>
        <!-- Login Screen -->
        <div class="login-container" id="loginContainer">
            <div class="login-form">
                <h1><i class="fas fa-user-shield"></i> Giriş Yap</h1>
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="username">Kullanıcı Adı:</label>
                        <input type="text" id="username" name="username" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="password">Şifre:</label>
                        <input type="password" id="password" name="password" required autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Giriş Yap
                    </button>
                </form>
                <div style="text-align: center; margin-top: 1rem;">
                    <button type="button" class="btn btn-link" onclick="showOfflineMode()">
                        <i class="fas fa-wifi-slash"></i> Çevrimdışı Modda Devam Et
                    </button>
                </div>
            </div>
        </div>
        <!-- Main Application -->
        <div class="app-container" id="appContainer">
            <!-- App Header -->
            <div class="app-header">
                <div class="app-title">
                    <i class="fas fa-tshirt"></i>
                    ProClean Yönetim Sistemi
                </div>
                <div class="user-info">
                    <div class="status-indicator" title="Sistem Aktif"></div>
                    <span id="currentUser">Admin</span>
                    <span id="connectionStatus">Çevrimiçi</span>
                    <button onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Çıkış
                    </button>
                </div>
            </div>
            <!-- Navigation Tabs -->
            <div class="tabs">
                <div class="tab active" onclick="switchTab('paketleme')">
                    <i class="fas fa-box"></i> Paketleme
                </div>
                <div class="tab" onclick="switchTab('stok')">
                    <i class="fas fa-warehouse"></i> Stok Yönetimi
                </div>
                <div class="tab" onclick="switchTab('raporlar')">
                    <i class="fas fa-chart-bar"></i> Raporlar
                </div>
                <div class="tab" onclick="switchTab('ayarlar')">
                    <i class="fas fa-cog"></i> Ayarlar
                </div>
            </div>
            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Paketleme Tab -->
                <div id="paketleme" class="tab-pane active">
                    <div class="card">
                        <div class="packaging-header">
                            <div class="customer-info">
                                <div class="info-group">
                                    <label>Müşteri:</label>
                                    <select id="customerSelect" onchange="loadCustomerData()">
                                        <option value="">Müşteri Seçin</option>
                                    </select>
                                </div>
                                <div class="info-group">
                                    <label>Telefon:</label>
                                    <span id="customerPhone">-</span>
                                </div>
                                <div class="info-group">
                                    <label>Adres:</label>
                                    <span id="customerAddress">-</span>
                                </div>
                                <div class="info-group">
                                    <label>Tarih:</label>
                                    <span id="currentDate"></span>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="openCustomerModal()">
                                    <i class="fas fa-user-plus"></i> Yeni Müşteri
                                </button>
                                <button class="btn btn-success" onclick="completePackaging()">
                                    <i class="fas fa-check"></i> Paketlemeyi Tamamla
                                </button>
                            </div>
                        </div>
                        <div class="packaging-content">
                            <!-- Barcode Section -->
                            <div class="barcode-section">
                                <h3><i class="fas fa-barcode"></i> Barkod Okuyucu</h3>
                                <div class="barcode-input">
                                    <input type="text" id="barcodeInput" placeholder="Barkod okutun veya yazın" onkeypress="handleBarcodeInput(event)">
                                    <button onclick="processBarcodeManually()">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div id="barcodeDisplay"></div>
                                
                                <div class="quick-buttons">
                                    <button class="quick-btn" onclick="addQuickItem('Gömlek')">
                                        <i class="fas fa-shirt"></i>
                                        Gömlek
                                        <span class="quantity-badge" id="gomlek-count">0</span>
                                    </button>
                                    <button class="quick-btn" onclick="addQuickItem('Pantolon')">
                                        <i class="fas fa-tshirt"></i>
                                        Pantolon
                                        <span class="quantity-badge" id="pantolon-count">0</span>
                                    </button>
                                    <button class="quick-btn" onclick="addQuickItem('Etek')">
                                        <i class="fas fa-dress"></i>
                                        Etek
                                        <span class="quantity-badge" id="etek-count">0</span>
                                    </button>
                                    <button class="quick-btn" onclick="addQuickItem('Ceket')">
                                        <i class="fas fa-jacket"></i>
                                        Ceket
                                        <span class="quantity-badge" id="ceket-count">0</span>
                                    </button>
                                    <button class="quick-btn" onclick="addQuickItem('Elbise')">
                                        <i class="fas fa-dress"></i>
                                        Elbise
                                        <span class="quantity-badge" id="elbise-count">0</span>
                                    </button>
                                    <button class="quick-btn" onclick="addQuickItem('Diğer')">
                                        <i class="fas fa-question"></i>
                                        Diğer
                                        <span class="quantity-badge" id="diger-count">0</span>
                                    </button>
                                </div>
                            </div>
                            <!-- Pending Packages -->
                            <div class="pending-packages">
                                <h3><i class="fas fa-clock"></i> Bekleyen Paketler</h3>
                                <div class="search-container">
                                    <input type="text" class="search-input" id="packageSearch" placeholder="Paket ara..." oninput="filterPackages()">
                                    <i class="fas fa-search search-icon"></i>
                                </div>
                                <table class="package-table" id="packageTable">
                                    <thead>
                                        <tr>
                                            <th>Sıra</th>
                                            <th>Ürün</th>
                                            <th>Adet</th>
                                            <th>Fiyat</th>
                                            <th>Durum</th>
                                            <th>İşlem</th>
                                        </tr>
                                    </thead>
                                    <tbody id="packageTableBody">
                                        <!-- Paket verileri buraya eklenecek -->
                                    </tbody>
                                </table>
                            </div>
                            <!-- Package Details -->
                            <div class="package-details">
                                <h3><i class="fas fa-info-circle"></i> Paket Detayları</h3>
                                <div id="selectedPackageDetails">
                                    <p>Bir paket seçin...</p>
                                </div>
                                
                                <div class="package-actions">
                                    <button class="btn btn-warning" onclick="editSelectedPackage()" id="editPackageBtn" disabled>
                                        <i class="fas fa-edit"></i> Düzenle
                                    </button>
                                    <button class="btn btn-success" onclick="completeSelectedPackage()" id="completePackageBtn" disabled>
                                        <i class="fas fa-check"></i> Tamamla
                                    </button>
                                    <button class="btn btn-danger" onclick="deleteSelectedPackage()" id="deletePackageBtn" disabled>
                                        <i class="fas fa-trash"></i> Sil
                                    </button>
                                    <button class="btn btn-primary" onclick="printPackageLabel()" id="printLabelBtn" disabled>
                                        <i class="fas fa-print"></i> Etiket Yazdır
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Stok Yönetimi Tab -->
                <div id="stok" class="tab-pane">
                    <div class="card">
                        <div class="packaging-header">
                            <h2><i class="fas fa-warehouse"></i> Stok Yönetimi</h2>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="addNewStock()">
                                    <i class="fas fa-plus"></i> Yeni Ürün
                                </button>
                                <button class="btn btn-secondary" onclick="exportStockData()">
                                    <i class="fas fa-download"></i> Dışa Aktar
                                </button>
                                <button class="btn btn-secondary" onclick="importStockData()">
                                    <i class="fas fa-upload"></i> İçe Aktar
                                </button>
                            </div>
                        </div>
                        <div class="search-container">
                            <input type="text" class="search-input" id="stockSearch" placeholder="Ürün ara..." oninput="filterStock()">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <table class="stock-table" id="stockTable">
                            <thead>
                                <tr>
                                    <th>Ürün Kodu</th>
                                    <th>Ürün Adı</th>
                                    <th>Kategori</th>
                                    <th>Mevcut Stok</th>
                                    <th>Minimum Stok</th>
                                    <th>Birim Fiyat</th>
                                    <th>Durum</th>
                                    <th>İşlemler</th>
                                </tr>
                            </thead>
                            <tbody id="stockTableBody">
                                <!-- Stok verileri buraya eklenecek -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Raporlar Tab -->
                <div id="raporlar" class="tab-pane">
                    <div class="card">
                        <h2><i class="fas fa-chart-bar"></i> Raporlar ve Analizler</h2>
                        <div class="packaging-header">
                            <div class="customer-info">
                                <div class="info-group">
                                    <label>Başlangıç Tarihi:</label>
                                    <input type="date" id="reportStartDate">
                                </div>
                                <div class="info-group">
                                    <label>Bitiş Tarihi:</label>
                                    <input type="date" id="reportEndDate">
                                </div>
                                <div class="info-group">
                                    <label>Rapor Türü:</label>
                                    <select id="reportType">
                                        <option value="daily">Günlük</option>
                                        <option value="weekly">Haftalık</option>
                                        <option value="monthly">Aylık</option>
                                        <option value="custom">Özel Aralık</option>
                                    </select>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="generateReport()">
                                    <i class="fas fa-chart-line"></i> Rapor Oluştur
                                </button>
                                <button class="btn btn-secondary" onclick="exportReport()">
                                    <i class="fas fa-file-pdf"></i> PDF İndir
                                </button>
                            </div>
                        </div>
                        <div id="reportContent">
                            <div style="text-align: center; padding: 3rem; color: #999;">
                                <i class="fas fa-chart-bar" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                                <p>Rapor oluşturmak için yukarıdaki filtreleri kullanın</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Ayarlar Tab -->
                <div id="ayarlar" class="tab-pane">
                    <div class="card">
                        <h2><i class="fas fa-cog"></i> Sistem Ayarları</h2>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                            <div class="card">
                                <h3><i class="fas fa-user"></i> Kullanıcı Ayarları</h3>
                                <div class="form-group">
                                    <label>Kullanıcı Adı:</label>
                                    <input type="text" id="settingsUsername" placeholder="Kullanıcı adınız">
                                </div>
                                <div class="form-group">
                                    <label>E-posta:</label>
                                    <input type="email" id="settingsEmail" placeholder="E-posta adresiniz">
                                </div>
                                <button class="btn btn-primary" onclick="saveUserSettings()">
                                    <i class="fas fa-save"></i> Kaydet
                                </button>
                            </div>
                            <div class="card">
                                <h3><i class="fas fa-palette"></i> Görünüm Ayarları</h3>
                                <div class="form-group">
                                    <label>Tema:</label>
                                    <select id="themeSelect" onchange="changeTheme()">
                                        <option value="light">Açık Tema</option>
                                        <option value="dark">Koyu Tema</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Dil:</label>
                                    <select id="languageSelect" onchange="changeLanguage()">
                                        <option value="tr">Türkçe</option>
                                        <option value="en">English</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card">
                                <h3><i class="fas fa-database"></i> Veri Yönetimi</h3>
                                <button class="btn btn-secondary" onclick="backupData()" style="margin-bottom: 1rem; width: 100%;">
                                    <i class="fas fa-download"></i> Veri Yedekle
                                </button>
                                <button class="btn btn-warning" onclick="restoreData()" style="margin-bottom: 1rem; width: 100%;">
                                    <i class="fas fa-upload"></i> Veri Geri Yükle
                                </button>
                                <button class="btn btn-danger" onclick="clearAllData()" style="width: 100%;">
                                    <i class="fas fa-trash"></i> Tüm Verileri Temizle
                                </button>
                            </div>
                            <div class="card">
                                <h3><i class="fas fa-wifi"></i> Bağlantı Ayarları</h3>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="offlineMode" onchange="toggleOfflineMode()">
                                        Çevrimdışı Mod
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="autoSync" onchange="toggleAutoSync()">
                                        Otomatik Senkronizasyon
                                    </label>
                                </div>
                                <button class="btn btn-primary" onclick="syncData()" style="width: 100%;">
                                    <i class="fas fa-sync"></i> Şimdi Senkronize Et
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer -->
            <div class="app-footer">
                <div class="container-info">
                    <span>Toplam Paket: <strong id="totalPackages">0</strong></span>
                    <span>Bekleyen: <strong id="pendingPackages">0</strong></span>
                    <span>Tamamlanan: <strong id="completedPackages">0</strong></span>
                </div>
                <div>
                    <span id="lastSyncTime">Son Senkronizasyon: Hiç</span>
                </div>
            </div>
        </div>
    </div>
    <!-- Customer Modal -->
    <div class="modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Yeni Müşteri Ekle</h3>
                <button class="modal-close" onclick="closeCustomerModal()">&times;</button>
            </div>
            <form id="customerForm" onsubmit="saveCustomer(event)">
                <div class="form-group">
                    <label>Ad Soyad:</label>
                    <input type="text" id="customerName" required>
                </div>
                <div class="form-group">
                    <label>Telefon:</label>
                    <input type="tel" id="customerPhoneInput" required>
                </div>
                <div class="form-group">
                    <label>Adres:</label>
                    <textarea id="customerAddressInput" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>E-posta:</label>
                    <input type="email" id="customerEmail">
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeCustomerModal()">İptal</button>
                    <button type="submit" class="btn btn-primary">Kaydet</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Quantity Modal -->
    <div class="quantity-modal" id="quantityModal">
        <div class="quantity-content">
            <h3>Adet Belirle</h3>
            <p id="quantityItemName"></p>
            <input type="number" class="quantity-input" id="quantityInput" min="1" value="1">
            <div class="quantity-buttons">
                <button class="btn btn-secondary" onclick="closeQuantityModal()">İptal</button>
                <button class="btn btn-primary" onclick="confirmQuantity()">Tamam</button>
            </div>
        </div>
    </div>
    <!-- Offline/Online Indicators -->
    <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi-slash"></i> Çevrimdışı Mod Aktif
    </div>
    <div class="online-indicator" id="onlineIndicator">
        <i class="fas fa-wifi"></i> Bağlantı Yeniden Kuruldu
    </div>
    <!-- Toast Container -->
    <div id="toastContainer"></div>
    <script>
        // Global Variables
        let currentUser = null;
        let isOfflineMode = false;
        let packages = [];
        let customers = [];
        let stockItems = [];
        let selectedPackageId = null;
        let currentQuickItem = null;
        let lastSyncTime = null;
        // Error Handling System
        class ErrorHandler {
            static logError(error, context = '') {
                const errorInfo = {
                    message: error.message,
                    stack: error.stack,
                    context: context,
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent
                };
                
                console.error('ProClean Error:', errorInfo);
                
                // Store error in localStorage for debugging
                try {
                    const errors = JSON.parse(localStorage.getItem('proCleanErrors') || '[]');
                    errors.push(errorInfo);
                    // Keep only last 50 errors
                    if (errors.length > 50) {
                        errors.splice(0, errors.length - 50);
                    }
                    localStorage.setItem('proCleanErrors', JSON.stringify(errors));
                } catch (e) {
                    console.warn('Could not save error to localStorage:', e);
                }
                
                // Show user-friendly error message
                this.showUserError(error, context);
            }
            static showUserError(error, context) {
                let userMessage = 'Bir hata oluştu. Lütfen tekrar deneyin.';
                
                if (error.message.includes('network') || error.message.includes('fetch')) {
                    userMessage = 'Bağlantı hatası. İnternet bağlantınızı kontrol edin.';
                } else if (error.message.includes('storage') || error.message.includes('quota')) {
                    userMessage = 'Depolama alanı dolu. Lütfen eski verileri temizleyin.';
                } else if (context === 'barcode') {
                    userMessage = 'Barkod okuma hatası. Barkodu tekrar okutun.';
                } else if (context === 'print') {
                    userMessage = 'Yazdırma hatası. Yazıcı bağlantınızı kontrol edin.';
                }
                showToast(userMessage, 'error');
            }
            static async handleAsyncError(asyncFunction, context = '') {
                try {
                    return await asyncFunction();
                } catch (error) {
                    this.logError(error, context);
                    return null;
                }
            }
        }
        // Enhanced Toast System
        function showToast(message, type = 'info', duration = 5000) {
            try {
                const toastContainer = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                const icon = {
                    success: 'fas fa-check-circle',
                    error: 'fas fa-exclamation-triangle',
                    warning: 'fas fa-exclamation-circle',
                    info: 'fas fa-info-circle'
                }[type] || 'fas fa-info-circle';
                toast.innerHTML = `
                    <i class="${icon}"></i>
                    <span style="margin-left: 0.5rem;">${message}</span>
                    <button onclick="this.parentElement.remove()" style="background: none; border: none; color: white; margin-left: 1rem; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                toastContainer.appendChild(toast);
                
                // Show toast
                setTimeout(() => toast.classList.add('show'), 100);
                
                // Auto remove
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentElement) {
                            toast.parentElement.removeChild(toast);
                        }
                    }, 300);
                }, duration);
            } catch (error) {
                console.error('Toast error:', error);
            }
        }
        // Offline Mode Detection
        function setupOfflineDetection() {
            function updateConnectionStatus() {
                const isOnline = navigator.onLine;
                const connectionStatus = document.getElementById('connectionStatus');
                const offlineIndicator = document.getElementById('offlineIndicator');
                const onlineIndicator = document.getElementById('onlineIndicator');
                
                if (isOnline && !isOfflineMode) {
                    connectionStatus.textContent = 'Çevrimiçi';
                    connectionStatus.style.color = '#2ecc71';
                    offlineIndicator.style.display = 'none';
                    
                    // Show online indicator briefly
                    onlineIndicator.style.display = 'block';
                    setTimeout(() => {
                        onlineIndicator.style.display = 'none';
                    }, 3000);
                    
                    // Auto sync when coming back online
                    if (localStorage.getItem('autoSync') === 'true') {
                        syncData();
                    }
                } else {
                    connectionStatus.textContent = 'Çevrimdışı';
                    connectionStatus.style.color = '#e74c3c';
                    offlineIndicator.style.display = 'block';
                    onlineIndicator.style.display = 'none';
                }
            }
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);
            updateConnectionStatus();
        }
        // Data Management
        class DataManager {
            static saveToLocal(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    ErrorHandler.logError(error, 'localStorage save');
                    return false;
                }
            }
            static loadFromLocal(key, defaultValue = null) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : defaultValue;
                } catch (error) {
                    ErrorHandler.logError(error, 'localStorage load');
                    return defaultValue;
                }
            }
            static syncData() {
                try {
                    // Save current state
                    this.saveToLocal('packages', packages);
                    this.saveToLocal('customers', customers);
                    this.saveToLocal('stockItems', stockItems);
                    this.saveToLocal('lastSyncTime', new Date().toISOString());
                    
                    lastSyncTime = new Date();
                    updateLastSyncDisplay();
                    showToast('Veriler başarıyla senkronize edildi', 'success');
                    return true;
                } catch (error) {
                    ErrorHandler.logError(error, 'data sync');
                    return false;
                }
            }
            static loadData() {
                try {
                    packages = this.loadFromLocal('packages', []);
                    customers = this.loadFromLocal('customers', this.getDefaultCustomers());
                    stockItems = this.loadFromLocal('stockItems', this.getDefaultStock());
                    
                    const savedSyncTime = this.loadFromLocal('lastSyncTime');
                    if (savedSyncTime) {
                        lastSyncTime = new Date(savedSyncTime);
                    }
                    
                    // Load user preferences
                    const savedUser = this.loadFromLocal('currentUser');
                    if (savedUser) {
                        currentUser = savedUser;
                        document.getElementById('currentUser').textContent = currentUser.name || 'Admin';
                    }
                    
                    // Load settings
                    const offlineMode = this.loadFromLocal('offlineMode', false);
                    if (offlineMode) {
                        toggleOfflineMode(true);
                    }
                    return true;
                } catch (error) {
                    ErrorHandler.logError(error, 'data load');
                    return false;
                }
            }
            static getDefaultCustomers() {
                return [
                    { id: 1, name: 'Ahmet Yılmaz', phone: '0532 123 4567', address: 'Merkez Mah. Atatürk Cad. No:15 Ankara', email: 'ahmet@email.com' },
                    { id: 2, name: 'Fatma Kara', phone: '0533 987 6543', address: 'Yenişehir Mah. İstiklal Cad. No:22 İstanbul', email: 'fatma@email.com' },
                    { id: 3, name: 'Mehmet Demir', phone: '0534 456 7890', address: 'Çankaya Mah. Gazi Cad. No:8 İzmir', email: 'mehmet@email.com' }
                ];
            }
            static getDefaultStock() {
                return [
                    { id: 1, code: 'GML001', name: 'Erkek Gömlek', category: 'Gömlek', stock: 15, minStock: 5, price: 8.50, status: 'stokta' },
                    { id: 2, code: 'PNT001', name: 'Erkek Pantolonu', category: 'Pantolon', stock: 3, minStock: 5, price: 12.00, status: 'az-stok' },
                    { id: 3, code: 'ELB001', name: 'Kadın Elbise', category: 'Elbise', stock: 0, minStock: 3, price: 15.00, status: 'kritik' },
                    { id: 4, code: 'CKT001', name: 'Erkek Ceket', category: 'Ceket', stock: 8, minStock: 3, price: 20.00, status: 'stokta' },
                    { id: 5, code: 'ETK001', name: 'Kadın Etek', category: 'Etek', stock: 12, minStock: 4, price: 10.00, status: 'stokta' }
                ];
            }
        }
        // Login System
        function handleLogin(event) {
            event.preventDefault();
            
            try {
                showLoading(true);
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // Simulate authentication delay
                setTimeout(() => {
                    try {
                        // Simple authentication (in real app, this would be server-side)
                        if (username === 'admin' && password === 'admin123') {
                            currentUser = { name: 'Admin', username: username };
                            DataManager.saveToLocal('currentUser', currentUser);
                            
                            document.getElementById('loginContainer').style.display = 'none';
                            document.getElementById('appContainer').style.display = 'flex';
                            
                            initializeApp();
                            showToast('Başarıyla giriş yapıldı', 'success');
                        } else {
                            showToast('Geçersiz kullanıcı adı veya şifre', 'error');
                        }
                    } catch (error) {
                        ErrorHandler.logError(error, 'login');
                    } finally {
                        showLoading(false);
                    }
                }, 1000);
                
            } catch (error) {
                ErrorHandler.logError(error, 'login form');
                showLoading(false);
            }
        }
        function showOfflineMode() {
            try {
                isOfflineMode = true;
                DataManager.saveToLocal('offlineMode', true);
                
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('appContainer').style.display = 'flex';
                
                initializeApp();
                showToast('Çevrimdışı modda başlatıldı', 'warning');
            } catch (error) {
                ErrorHandler.logError(error, 'offline mode');
            }
        }
        function logout() {
            try {
                if (confirm('Çıkış yapmak istediğinizden emin misiniz?')) {
                    // Save current state before logout
                    DataManager.syncData();
                    
                    currentUser = null;
                    DataManager.saveToLocal('currentUser', null);
                    
                    document.getElementById('appContainer').style.display = 'none';
                    document.getElementById('loginContainer').style.display = 'flex';
                    
                    // Clear form
                    document.getElementById('loginForm').reset();
                    
                    showToast('Başarıyla çıkış yapıldı', 'success');
                }
            } catch (error) {
                ErrorHandler.logError(error, 'logout');
            }
        }
        // App Initialization
        function initializeApp() {
            try {
                // Load data
                DataManager.loadData();
                
                // Setup date
                updateCurrentDate();
                
                // Load customers into dropdown
                loadCustomersDropdown();
                
                // Load tables
                loadPackageTable();
                loadStockTable();
                updateFooterStats();
                updateLastSyncDisplay();
                
                // Setup offline detection
                setupOfflineDetection();
                
                // Auto-save every 30 seconds
                setInterval(() => {
                    if (packages.length > 0 || customers.length > 0) {
                        DataManager.syncData();
                    }
                }, 30000);
                
                showToast('Sistem başarıyla yüklendi', 'success');
            } catch (error) {
                ErrorHandler.logError(error, 'app initialization');
            }
        }
        // Tab Management
        function switchTab(tabName) {
            try {
                // Remove active class from all tabs and panes
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                
                // Add active class to selected tab and pane
                event.target.classList.add('active');
                document.getElementById(tabName).classList.add('active');
                
                // Refresh data if needed
                if (tabName === 'stok') {
                    loadStockTable();
                } else if (tabName === 'raporlar') {
                    setupReportDates();
                }
            } catch (error) {
                ErrorHandler.logError(error, 'tab switch');
            }
        }
        // Customer Management
        function loadCustomersDropdown() {
            try {
                const select = document.getElementById('customerSelect');
                select.innerHTML = '<option value="">Müşteri Seçin</option>';
                
                customers.forEach(customer => {
                    const option = document.createElement('option');
                    option.value = customer.id;
                    option.textContent = customer.name;
                    select.appendChild(option);
                });
            } catch (error) {
                ErrorHandler.logError(error, 'load customers dropdown');
            }
        }
        function loadCustomerData() {
            try {
                const customerId = document.getElementById('customerSelect').value;
                if (!customerId) {
                    document.getElementById('customerPhone').textContent = '-';
                    document.getElementById('customerAddress').textContent = '-';
                    return;
                }
                
                const customer = customers.find(c => c.id == customerId);
                if (customer) {
                    document.getElementById('customerPhone').textContent = customer.phone;
                    document.getElementById('customerAddress').textContent = customer.address;
                }
            } catch (error) {
                ErrorHandler.logError(error, 'load customer data');
            }
        }
        function openCustomerModal() {
            try {
                document.getElementById('customerModal').style.display = 'flex';
                document.getElementById('customerName').focus();
            } catch (error) {
                ErrorHandler.logError(error, 'open customer modal');
            }
        }
        function closeCustomerModal() {
            try {
                document.getElementById('customerModal').style.display = 'none';
                document.getElementById('customerForm').reset();
            } catch (error) {
                ErrorHandler.logError(error, 'close customer modal');
            }
        }
        function saveCustomer(event) {
            event.preventDefault();
            
            try {
                const newCustomer = {
                    id: Date.now(),
                    name: document.getElementById('customerName').value,
                    phone: document.getElementById('customerPhoneInput').value,
                    address: document.getElementById('customerAddressInput').value,
                    email: document.getElementById('customerEmail').value
                };
                
                customers.push(newCustomer);
                DataManager.saveToLocal('customers', customers);
                
                loadCustomersDropdown();
                
                // Select the new customer
                document.getElementById('customerSelect').value = newCustomer.id;
                loadCustomerData();
                
                closeCustomerModal();
                showToast('Müşteri başarıyla eklendi', 'success');
            } catch (error) {
                ErrorHandler.logError(error, 'save customer');
            }
        }
        // Barcode Management
        function handleBarcodeInput(event) {
            if (event.key === 'Enter') {
                processBarcodeManually();
            }
        }
        function processBarcodeManually() {
            try {
                const barcode = document.getElementById('barcodeInput').value.trim();
                if (!barcode) {
                    showToast('Lütfen geçerli bir barkod girin', 'warning');
                    return;
                }
                
                processBarcode(barcode);
                document.getElementById('barcodeInput').value = '';
            } catch (error) {
                ErrorHandler.logError(error, 'barcode processing');
            }
        }
        function processBarcode(barcode) {
            try {
                // Find stock item by barcode or code
                const stockItem = stockItems.find(item => 
                    item.code === barcode || item.id.toString() === barcode
                );
                
                if (stockItem) {
                    addPackageItem(stockItem.name, 1, stockItem.price);
                    generateBarcode(barcode);
                    showToast(`${stockItem.name} eklendi`, 'success');
                } else {
                    showToast('Barkod bulunamadı. Ürünü manuel olarak ekleyin.', 'warning');
                }
            } catch (error) {
                ErrorHandler.logError(error, 'barcode process');
            }
        }
        function generateBarcode(code) {
            try {
                const canvas = document.createElement('canvas');
                JsBarcode(canvas, code, {
                    format: "CODE128",
                    width: 2,
                    height: 100,
                    displayValue: true
                });
                
                const display = document.getElementById('barcodeDisplay');
                display.innerHTML = '';
                display.appendChild(canvas);
            } catch (error) {
                ErrorHandler.logError(error, 'barcode generation');
            }
        }
        // Quick Buttons
        function addQuickItem(itemName) {
            try {
                currentQuickItem = itemName;
                document.getElementById('quantityItemName').textContent = itemName;
                document.getElementById('quantityInput').value = 1;
                document.getElementById('quantityModal').style.display = 'flex';
                document.getElementById('quantityInput').focus();
            } catch (error) {
                ErrorHandler.logError(error, 'add quick item');
            }
        }
        function closeQuantityModal() {
            try {
                document.getElementById('quantityModal').style.display = 'none';
                currentQuickItem = null;
            } catch (error) {
                ErrorHandler.logError(error, 'close quantity modal');
            }
        }
        function confirmQuantity() {
            try {
                const quantity = parseInt(document.getElementById('quantityInput').value);
                if (quantity > 0 && currentQuickItem) {
                    const stockItem = stockItems.find(item => 
                        item.name.toLowerCase().includes(currentQuickItem.toLowerCase())
                    );
                    
                    const price = stockItem ? stockItem.price : 10.00; // Default price
                    addPackageItem(currentQuickItem, quantity, price);
                    updateQuickButtonBadge(currentQuickItem, quantity);
                    
                    showToast(`${quantity} adet ${currentQuickItem} eklendi`, 'success');
                }
                closeQuantityModal();
            } catch (error) {
                ErrorHandler.logError(error, 'confirm quantity');
            }
        }
        function updateQuickButtonBadge(itemName, quantity) {
            try {
                const badgeId = itemName.toLowerCase().replace(/ğ/g, 'g').replace(/ü/g, 'u').replace(/ş/g, 's').replace(/ı/g, 'i').replace(/ö/g, 'o').replace(/ç/g, 'c') + '-count';
                const badge = document.getElementById(badgeId);
                if (badge) {
                    const currentCount = parseInt(badge.textContent) || 0;
                    badge.textContent = currentCount + quantity;
                }
            } catch (error) {
                ErrorHandler.logError(error, 'update badge');
            }
        }
        // Package Management
        function addPackageItem(name, quantity, price) {
            try {
                const customerId = document.getElementById('customerSelect').value;
                if (!customerId) {
                    showToast('Lütfen önce bir müşteri seçin', 'warning');
                    return;
                }
                
                const newPackage = {
                    id: Date.now(),
                    customerId: parseInt(customerId),
                    item: name,
                    quantity: quantity,
                    price: price,
                    total: quantity * price,
                    status: 'beklemede',
                    date: new Date().toISOString(),
                    barcode: generatePackageBarcode()
                };
                
                packages.push(newPackage);
                DataManager.saveToLocal('packages', packages);
                
                loadPackageTable();
                updateFooterStats();
            } catch (error) {
                ErrorHandler.logError(error, 'add package item');
            }
        }
        function generatePackageBarcode() {
            return 'PKG' + Date.now().toString().slice(-8);
        }
        function loadPackageTable() {
            try {
                const tbody = document.getElementById('packageTableBody');
                tbody.innerHTML = '';
                
                const filteredPackages = packages.filter(pkg => pkg.status === 'beklemede');
                
                filteredPackages.forEach((pkg, index) => {
                    const row = document.createElement('tr');
                    row.onclick = () => selectPackage(pkg.id);
                    
                    const customer = customers.find(c => c.id === pkg.customerId);
                    const customerName = customer ? customer.name : 'Bilinmeyen';
                    
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${pkg.item}</td>
                        <td>${pkg.quantity}</td>
                        <td>₺${pkg.total.toFixed(2)}</td>
                        <td><span class="status-${pkg.status}">${pkg.status === 'beklemede' ? 'Beklemede' : 'Sevk Edildi'}</span></td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="event.stopPropagation(); editPackage(${pkg.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deletePackage(${pkg.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
                if (filteredPackages.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = '<td colspan="6" style="text-align: center; color: #999;">Bekleyen paket bulunmamaktadır</td>';
                    tbody.appendChild(row);
                }
            } catch (error) {
                ErrorHandler.logError(error, 'load package table');
            }
        }
        function selectPackage(packageId) {
            try {
                // Remove previous selection
                document.querySelectorAll('.package-table tr').forEach(row => {
                    row.classList.remove('selected');
                });
                
                // Add selection to clicked row
                event.target.closest('tr').classList.add('selected');
                
                selectedPackageId = packageId;
                const pkg = packages.find(p => p.id === packageId);
                
                if (pkg) {
                    const customer = customers.find(c => c.id === pkg.customerId);
                    const customerName = customer ? customer.name : 'Bilinmeyen';
                    
                    document.getElementById('selectedPackageDetails').innerHTML = `
                        <div style="margin-bottom: 1rem;">
                            <strong>Paket ID:</strong> ${pkg.id}
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Müşteri:</strong> ${customerName}
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Ürün:</strong> ${pkg.item}
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Adet:</strong> ${pkg.quantity}
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Birim Fiyat:</strong> ₺${pkg.price.toFixed(2)}
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Toplam:</strong> ₺${pkg.total.toFixed(2)}
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Tarih:</strong> ${new Date(pkg.date).toLocaleDateString('tr-TR')}
                        </div>
                        <div>
                            <strong>Barkod:</strong> ${pkg.barcode}
                        </div>
                    `;
                    
                    // Enable action buttons
                    document.getElementById('editPackageBtn').disabled = false;
                    document.getElementById('completePackageBtn').disabled = false;
                    document.getElementById('deletePackageBtn').disabled = false;
                    document.getElementById('printLabelBtn').disabled = false;
                }
            } catch (error) {
                ErrorHandler.logError(error, 'select package');
            }
        }
        function editSelectedPackage() {
            if (selectedPackageId) {
                editPackage(selectedPackageId);
            }
        }
        function completeSelectedPackage() {
            if (selectedPackageId) {
                completePackage(selectedPackageId);
            }
        }
        function deleteSelectedPackage() {
            if (selectedPackageId) {
                deletePackage(selectedPackageId);
            }
        }
        function editPackage(packageId) {
            try {
                const pkg = packages.find(p => p.id === packageId);
                if (!pkg) return;
                
                const newQuantity = prompt('Yeni adet:', pkg.quantity);
                if (newQuantity && !isNaN(newQuantity) && newQuantity > 0) {
                    pkg.quantity = parseInt(newQuantity);
                    pkg.total = pkg.quantity * pkg.price;
                    
                    DataManager.saveToLocal('packages', packages);
                    loadPackageTable();
                    updateFooterStats();
                    
                    showToast('Paket başarıyla güncellendi', 'success');
                }
            } catch (error) {
                ErrorHandler.logError(error, 'edit package');
            }
        }
        function completePackage(packageId) {
            try {
                const pkg = packages.find(p => p.id === packageId);
                if (pkg) {
                    pkg.status = 'sevk-edildi';
                    pkg.completedDate = new Date().toISOString();
                    
                    DataManager.saveToLocal('packages', packages);
                    loadPackageTable();
                    updateFooterStats();
                    
                    // Clear selection
                    selectedPackageId = null;
                    document.getElementById('selectedPackageDetails').innerHTML = '<p>Bir paket seçin...</p>';
                    
                    showToast('Paket tamamlandı', 'success');
                }
            } catch (error) {
                ErrorHandler.logError(error, 'complete package');
            }
        }
        function deletePackage(packageId) {
            try {
                if (confirm('Bu paketi silmek istediğinizden emin misiniz?')) {
                    packages = packages.filter(p => p.id !== packageId);
                    DataManager.saveToLocal('packages', packages);
                    
                    loadPackageTable();
                    updateFooterStats();
                    
                    // Clear selection if deleted package was selected
                    if (selectedPackageId === packageId) {
                        selectedPackageId = null;
                        document.getElementById('selectedPackageDetails').innerHTML = '<p>Bir paket seçin...</p>';
                    }
                    
                    showToast('Paket silindi', 'success');
                }
            } catch (error) {
                ErrorHandler.logError(error, 'delete package');
            }
        }
        function printPackageLabel() {
            try {
                if (!selectedPackageId) return;
                
                const pkg = packages.find(p => p.id === selectedPackageId);
                if (!pkg) return;
                
                const customer = customers.find(c => c.id === pkg.customerId);
                
                ErrorHandler.handleAsyncError(async () => {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: [80, 120] // Label size
                    });
                    
                    // Add logo/title
                    doc.setFontSize(16);
                    doc.setFont('helvetica', 'bold');
                    doc.text('ProClean', 40, 15, { align: 'center' });
                    
                    // Add barcode
                    const canvas = document.createElement('canvas');
                    JsBarcode(canvas, pkg.barcode, {
                        format: "CODE128",
                        width: 1,
                        height: 50,
                        displayValue: false
                    });
                    
                    const imgData = canvas.toDataURL('image/png');
                    doc.addImage(imgData, 'PNG', 10, 20, 60, 20);
                    
                    // Add details
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'normal');
                    
                    doc.text(`Paket: ${pkg.barcode}`, 5, 50);
                    doc.text(`Müşteri: ${customer ? customer.name : 'Bilinmeyen'}`, 5, 58);
                    doc.text(`Ürün: ${pkg.item}`, 5, 66);
                    doc.text(`Adet: ${pkg.quantity}`, 5, 74);
                    doc.text(`Tarih: ${new Date(pkg.date).toLocaleDateString('tr-TR')}`, 5, 82);
                    
                    // Save or print
                    doc.save(`etiket_${pkg.barcode}.pdf`);
                    showToast('Etiket başarıyla oluşturuldu', 'success');
                }, 'print');
                
            } catch (error) {
                ErrorHandler.logError(error, 'print label');
            }
        }
        function filterPackages() {
            try {
                const searchTerm = document.getElementById('packageSearch').value.toLowerCase();
                const rows = document.querySelectorAll('#packageTableBody tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            } catch (error) {
                ErrorHandler.logError(error, 'filter packages');
            }
        }
        function completePackaging() {
            try {
                const customerId = document.getElementById('customerSelect').value;
                if (!customerId) {
                    showToast('Lütfen önce bir müşteri seçin', 'warning');
                    return;
                }
                
                const pendingPackages = packages.filter(p => p.customerId == customerId && p.status === 'beklemede');
                if (pendingPackages.length === 0) {
                    showToast('Tamamlanacak paket bulunmamaktadır', 'warning');
                    return;
                }
                
                if (confirm(`${pendingPackages.length} adet paketi tamamlamak istediğinizden emin misiniz?`)) {
                    pendingPackages.forEach(pkg => {
                        pkg.status = 'sevk-edildi';
                        pkg.completedDate = new Date().toISOString();
                    });
                    
                    DataManager.saveToLocal('packages', packages);
                    loadPackageTable();
                    updateFooterStats();
                    
                    // Reset quick button badges
                    document.querySelectorAll('.quantity-badge').forEach(badge => {
                        badge.textContent = '0';
                    });
                    
                    showToast(`${pendingPackages.length} paket tamamlandı`, 'success');
                }
            } catch (error) {
                ErrorHandler.logError(error, 'complete packaging');
            }
        }
        // Stock Management
        function loadStockTable() {
            try {
                const tbody = document.getElementById('stockTableBody');
                tbody.innerHTML = '';
                
                stockItems.forEach(item => {
                    const row = document.createElement('tr');
                    
                    // Determine status
                    let statusClass = 'status-stokta';
                    let statusText = 'Stokta';
                    
                    if (item.stock === 0) {
                        statusClass = 'status-kritik';
                        statusText = 'Kritik';
                    } else if (item.stock <= item.minStock) {
                        statusClass = 'status-az-stok';
                        statusText = 'Az Stok';
                    }
                    
                    row.innerHTML = `
                        <td>${item.code}</td>
                        <td>${item.name}</td>
                        <td>${item.category}</td>
                        <td>${item.stock}</td>
                        <td>${item.minStock}</td>
                        <td>₺${item.price.toFixed(2)}</td>
                        <td><span class="${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editStock(${item.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteStock(${item.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
                if (stockItems.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = '<td colspan="8" style="text-align: center; color: #999;">Stok bulunmamaktadır</td>';
                    tbody.appendChild(row);
                }
            } catch (error) {
                ErrorHandler.logError(error, 'load stock table');
            }
        }
        function filterStock() {
            try {
                const searchTerm = document.getElementById('stockSearch').value.toLowerCase();
                const rows = document.querySelectorAll('#stockTableBody tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            } catch (error) {
                ErrorHandler.logError(error, 'filter stock');
            }
        }
        function addNewStock() {
            try {
                const name = prompt('Ürün Adı:');
                if (!name) return;
                
                const category = prompt('Kategori:');
                if (!category) return;
                
                const stock = prompt('Mevcut Stok:');
                if (!stock || isNaN(stock)) return;
                
                const minStock = prompt('Minimum Stok:');
                if (!minStock || isNaN(minStock)) return;
                
                const price = prompt('Birim Fiyat:');
                if (!price || isNaN(price)) return;
                
                const newItem = {
                    id: Date.now(),
                    code: 'ITM' + Date.now().toString().slice(-6),
                    name: name,
                    category: category,
                    stock: parseInt(stock),
                    minStock: parseInt(minStock),
                    price: parseFloat(price),
                    status: parseInt(stock) > parseInt(minStock) ? 'stokta' : 'az-stok'
                };
                
                stockItems.push(newItem);
                DataManager.saveToLocal('stockItems', stockItems);
                
                loadStockTable();
                showToast('Yeni ürün eklendi', 'success');
            } catch (error) {
                ErrorHandler.logError(error, 'add new stock');
            }
        }
        function editStock(itemId) {
            try {
                const item = stockItems.find(i => i.id === itemId);
                if (!item) return;
                
                const newStock = prompt('Yeni Stok Miktarı:', item.stock);
                if (newStock && !isNaN(newStock)) {
                    item.stock = parseInt(newStock);
                    
                    // Update status
                    if (item.stock === 0) {
                        item.status = 'kritik';
                    } else if (item.stock <= item.minStock) {
                        item.status = 'az-stok';
                    } else {
                        item.status = 'stokta';
                    }
                    
                    DataManager.saveToLocal('stockItems', stockItems);
                    loadStockTable();
                    showToast('Stok güncellendi', 'success');
                }
            } catch (error) {
                ErrorHandler.logError(error, 'edit stock');
            }
        }
        function deleteStock(itemId) {
            try {
                if (confirm('Bu ürünü silmek istediğinizden emin misiniz?')) {
                    stockItems = stockItems.filter(i => i.id !== itemId);
                    DataManager.saveToLocal('stockItems', stockItems);
                    
                    loadStockTable();
                    showToast('Ürün silindi', 'success');
                }
            } catch (error) {
                ErrorHandler.logError(error, 'delete stock');
            }
        }
        function exportStockData() {
            try {
                ErrorHandler.handleAsyncError(async () => {
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.json_to_sheet(stockItems);
                    XLSX.utils.book_append_sheet(wb, ws, 'Stok');
                    XLSX.writeFile(wb, `stok_${new Date().toISOString().split('T')[0]}.xlsx`);
                    showToast('Stok verileri dışa aktarıldı', 'success');
                }, 'export stock');
            } catch (error) {
                ErrorHandler.logError(error, 'export stock');
            }
        }
        function importStockData() {
            try {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.xlsx,.xls,.csv';
                
                input.onchange = (e) => {
                    ErrorHandler.handleAsyncError(async () => {
                        const file = e.target.files[0];
                        if (!file) return;
                        
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            try {
                                const data = new Uint8Array(e.target.result);
                                const workbook = XLSX.read(data, { type: 'array' });
                                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                                
                                // Validate and import data
                                const validItems = jsonData.filter(item => 
                                    item.name && item.category && 
                                    !isNaN(item.stock) && !isNaN(item.price)
                                );
                                
                                if (validItems.length > 0) {
                                    if (confirm(`${validItems.length} adet ürün içe aktarılacak. Devam etmek istiyor musunuz?`)) {
                                        validItems.forEach(item => {
                                            stockItems.push({
                                                id: Date.now() + Math.random(),
                                                code: item.code || 'ITM' + Date.now().toString().slice(-6),
                                                name: item.name,
                                                category: item.category,
                                                stock: parseInt(item.stock) || 0,
                                                minStock: parseInt(item.minStock) || 5,
                                                price: parseFloat(item.price) || 0,
                                                status: 'stokta'
                                            });
                                        });
                                        
                                        DataManager.saveToLocal('stockItems', stockItems);
                                        loadStockTable();
                                        showToast(`${validItems.length} ürün içe aktarıldı`, 'success');
                                    }
                                } else {
                                    showToast('Geçerli veri bulunamadı', 'error');
                                }
                            } catch (error) {
                                ErrorHandler.logError(error, 'import stock file processing');
                            }
                        };
                        reader.readAsArrayBuffer(file);
                    }, 'import stock');
                };
                
                input.click();
            } catch (error) {
                ErrorHandler.logError(error, 'import stock');
            }
        }
        // Reports
        function setupReportDates() {
            try {
                const today = new Date();
                const startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                
                document.getElementById('reportStartDate').value = startDate.toISOString().split('T')[0];
                document.getElementById('reportEndDate').value = today.toISOString().split('T')[0];
            } catch (error) {
                ErrorHandler.logError(error, 'setup report dates');
            }
        }
        function generateReport() {
            try {
                const startDate = new Date(document.getElementById('reportStartDate').value);
                const endDate = new Date(document.getElementById('reportEndDate').value);
                const reportType = document.getElementById('reportType').value;
                
                if (startDate > endDate) {
                    showToast('Başlangıç tarihi bitiş tarihinden sonra olamaz', 'error');
                    return;
                }
                
                const filteredPackages = packages.filter(pkg => {
                    const pkgDate = new Date(pkg.date);
                    return pkgDate >= startDate && pkgDate <= endDate;
                });
                
                const reportContent = document.getElementById('reportContent');
                
                if (filteredPackages.length === 0) {
                    reportContent.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: #999;">
                            <i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <p>Seçilen tarih aralığında veri bulunamadı</p>
                        </div>
                    `;
                    return;
                }
                
                // Calculate statistics
                const totalPackages = filteredPackages.length;
                const completedPackages = filteredPackages.filter(p => p.status === 'sevk-edildi').length;
                const pendingPackages = totalPackages - completedPackages;
                const totalRevenue = filteredPackages.reduce((sum, pkg) => sum + pkg.total, 0);
                
                // Group by date
                const dailyStats = {};
                filteredPackages.forEach(pkg => {
                    const date = new Date(pkg.date).toLocaleDateString('tr-TR');
                    if (!dailyStats[date]) {
                        dailyStats[date] = { count: 0, revenue: 0 };
                    }
                    dailyStats[date].count++;
                    dailyStats[date].revenue += pkg.total;
                });
                
                reportContent.innerHTML = `
                    <div class="card">
                        <h3><i class="fas fa-chart-bar"></i> Özet İstatistikler</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="card" style="text-align: center; background: #3498db; color: white;">
                                <h4>${totalPackages}</h4>
                                <p>Toplam Paket</p>
                            </div>
                            <div class="card" style="text-align: center; background: #2ecc71; color: white;">
                                <h4>${completedPackages}</h4>
                                <p>Tamamlanan</p>
                            </div>
                            <div class="card" style="text-align: center; background: #f39c12; color: white;">
                                <h4>${pendingPackages}</h4>
                                <p>Bekleyen</p>
                            </div>
                            <div class="card" style="text-align: center; background: #e74c3c; color: white;">
                                <h4>₺${totalRevenue.toFixed(2)}</h4>
                                <p>Toplam Gelir</p>
                            </div>
                        </div>
                        
                        <h3><i class="fas fa-calendar-alt"></i> Günlük Detaylar</h3>
                        <table class="stock-table">
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>Paket Sayısı</th>
                                    <th>Gelir</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.entries(dailyStats).map(([date, stats]) => `
                                    <tr>
                                        <td>${date}</td>
                                        <td>${stats.count}</td>
                                        <td>₺${stats.revenue.toFixed(2)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                showToast('Rapor oluşturuldu', 'success');
            } catch (error) {
                ErrorHandler.logError(error, 'generate report');
            }
        }
        function exportReport() {
            try {
                ErrorHandler.handleAsyncError(async () => {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Add title
                    doc.setFontSize(20);
                    doc.setFont('helvetica', 'bold');
                    doc.text('ProClean - Faaliyet Raporu', 20, 30);
                    
                    doc.setFontSize(12);
                    doc.setFont('helvetica', 'normal');
                    doc.text(`Rapor Tarihi: ${new Date().toLocaleDateString('tr-TR')}`, 20, 45);
                    
                    // Add statistics (this would be expanded based on current report data)
                    const startDate = document.getElementById('reportStartDate').value;
                    const endDate = document.getElementById('reportEndDate').value;
                    
                    doc.text(`Tarih Aralığı: ${startDate} - ${endDate}`, 20, 60);
                    
                    // Save
                    doc.save(`proclean_rapor_${new Date().toISOString().split('T')[0]}.pdf`);
                    showToast('Rapor PDF olarak kaydedildi', 'success');
                }, 'export report');
            } catch (error) {
                ErrorHandler.logError(error, 'export report');
            }
        }
        // Settings
        function saveUserSettings() {
            try {
                const username = document.getElementById('settingsUsername').value;
                const email = document.getElementById('settingsEmail').value;
                
                if (currentUser) {
                    currentUser.username = username || currentUser.username;
                    currentUser.email = email || currentUser.email;
                    
                    DataManager.saveToLocal('currentUser', currentUser);
                    showToast('Kullanıcı ayarları kaydedildi', 'success');
                }
            } catch (error) {
                ErrorHandler.logError(error, 'save user settings');
            }
        }
        function changeTheme() {
            try {
                const theme = document.getElementById('themeSelect').value;
                // Theme implementation would go here
                DataManager.saveToLocal('theme', theme);
                showToast(`${theme === 'dark' ? 'Koyu' : 'Açık'} tema seçildi`, 'info');
            } catch (error) {
                ErrorHandler.logError(error, 'change theme');
            }
        }
        function changeLanguage() {
            try {
                const language = document.getElementById('languageSelect').value;
                // Language implementation would go here
                DataManager.saveToLocal('language', language);
                showToast('Dil ayarı kaydedildi', 'info');
            } catch (error) {
                ErrorHandler.logError(error, 'change language');
            }
        }
        function toggleOfflineMode(force = null) {
            try {
                if (force !== null) {
                    isOfflineMode = force;
                } else {
                    isOfflineMode = document.getElementById('offlineMode').checked;
                }
                
                DataManager.saveToLocal('offlineMode', isOfflineMode);
                
                if (isOfflineMode) {
                    document.getElementById('offlineIndicator').style.display = 'block';
                    showToast('Çevrimdışı mod etkinleştirildi', 'warning');
                } else {
                    document.getElementById('offlineIndicator').style.display = 'none';
                    showToast('Çevrimiçi mod etkinleştirildi', 'success');
                }
            } catch (error) {
                ErrorHandler.logError(error, 'toggle offline mode');
            }
        }
        function toggleAutoSync() {
            try {
                const autoSync = document.getElementById('autoSync').checked;
                DataManager.saveToLocal('autoSync', autoSync);
                showToast(`Otomatik senkronizasyon ${autoSync ? 'etkinleştirildi' : 'devre dışı bırakıldı'}`, 'info');
            } catch (error) {
                ErrorHandler.logError(error, 'toggle auto sync');
            }
        }
        function syncData() {
            try {
                showLoading(true);
                
                setTimeout(() => {
                    try {
                        const success = DataManager.syncData();
                        if (success) {
                            showToast('Veriler başarıyla senkronize edildi', 'success');
                        } else {
                            showToast('Senkronizasyon sırasında hata oluştu', 'error');
                        }
                    } catch (error) {
                        ErrorHandler.logError(error, 'sync data');
                    } finally {
                        showLoading(false);
                    }
                }, 1000);
            } catch (error) {
                ErrorHandler.logError(error, 'sync data');
                showLoading(false);
            }
        }
        function backupData() {
            try {
                const backupData = {
                    packages: packages,
                    customers: customers,
                    stockItems: stockItems,
                    settings: {
                        theme: DataManager.loadFromLocal('theme'),
                        language: DataManager.loadFromLocal('language'),
                        autoSync: DataManager.loadFromLocal('autoSync')
                    },
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `proclean_backup_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showToast('Veri yedeği oluşturuldu', 'success');
            } catch (error) {
                ErrorHandler.logError(error, 'backup data');
            }
        }
        function restoreData() {
            try {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const backupData = JSON.parse(e.target.result);
                            
                            if (confirm('Mevcut veriler silinecek ve yedek geri yüklenecek. Devam etmek istiyor musunuz?')) {
                                if (backupData.packages) packages = backupData.packages;
                                if (backupData.customers) customers = backupData.customers;
                                if (backupData.stockItems) stockItems = backupData.stockItems;
                                
                                // Save restored data
                                DataManager.saveToLocal('packages', packages);
                                DataManager.saveToLocal('customers', customers);
                                DataManager.saveToLocal('stockItems', stockItems);
                                
                                // Reload UI
                                loadCustomersDropdown();
                                loadPackageTable();
                                loadStockTable();
                                updateFooterStats();
                                
                                showToast('Veri yedeği başarıyla geri yüklendi', 'success');
                            }
                        } catch (error) {
                            ErrorHandler.logError(error, 'restore data parsing');
                            showToast('Geçersiz yedek dosyası', 'error');
                        }
                    };
                    reader.readAsText(file);
                };
                
                input.click();
            } catch (error) {
                ErrorHandler.logError(error, 'restore data');
            }
        }
        function clearAllData() {
            try {
                if (confirm('TÜM VERİLER SİLİNECEK! Bu işlem geri alınamaz. Devam etmek istediğinizden emin misiniz?')) {
                    if (confirm('Son kez soruyorum: Tüm verileri silmek istediğinizden emin misiniz?')) {
                        // Clear all data
                        packages = [];
                        customers = DataManager.getDefaultCustomers();
                        stockItems = DataManager.getDefaultStock();
                        
                        // Clear localStorage
                        localStorage.removeItem('packages');
                        localStorage.removeItem('customers');
                        localStorage.removeItem('stockItems');
                        localStorage.removeItem('lastSyncTime');
                        
                        // Save default data
                        DataManager.saveToLocal('customers', customers);
                        DataManager.saveToLocal('stockItems', stockItems);
                        
                        // Reload UI
                        loadCustomersDropdown();
                        loadPackageTable();
                        loadStockTable();
                        updateFooterStats();
                        
                        showToast('Tüm veriler temizlendi', 'warning');
                    }
                }
            } catch (error) {
                ErrorHandler.logError(error, 'clear all data');
            }
        }
        // Utility Functions
        function updateCurrentDate() {
            try {
                document.getElementById('currentDate').textContent = new Date().toLocaleDateString('tr-TR');
            } catch (error) {
                ErrorHandler.logError(error, 'update current date');
            }
        }
        function updateFooterStats() {
            try {
                const total = packages.length;
                const pending = packages.filter(p => p.status === 'beklemede').length;
                const completed = packages.filter(p => p.status === 'sevk-edildi').length;
                
                document.getElementById('totalPackages').textContent = total;
                document.getElementById('pendingPackages').textContent = pending;
                document.getElementById('completedPackages').textContent = completed;
            } catch (error) {
                ErrorHandler.logError(error, 'update footer stats');
            }
        }
        function updateLastSyncDisplay() {
            try {
                const lastSyncElement = document.getElementById('lastSyncTime');
                if (lastSyncTime) {
                    lastSyncElement.textContent = `Son Senkronizasyon: ${lastSyncTime.toLocaleString('tr-TR')}`;
                } else {
                    lastSyncElement.textContent = 'Son Senkronizasyon: Hiç';
                }
            } catch (error) {
                ErrorHandler.logError(error, 'update last sync display');
            }
        }
        function showLoading(show) {
            try {
                const spinner = document.getElementById('loadingSpinner');
                spinner.style.display = show ? 'block' : 'none';
            } catch (error) {
                console.error('Loading spinner error:', error);
            }
        }
        // Window Controls
        function showExitConfirmation() {
            if (confirm('Uygulamadan çıkmak istediğinizden emin misiniz?')) {
                // In a real desktop app, this would close the window
                showToast('Uygulama kapatılıyor...', 'info');
                setTimeout(() => {
                    document.body.style.opacity = '0';
                }, 1000);
            }
        }
        function minimizeWindow() {
            showToast('Uygulama simge durumuna küçültüldü', 'info');
        }
        function toggleMaximize() {
            const window = document.querySelector('.desktop-window');
            if (window.style.width === '100vw') {
                window.style.width = '';
                window.style.height = '';
                window.style.margin = '10px';
                showToast('Uygulama pencere moduna alındı', 'info');
            } else {
                window.style.width = '100vw';
                window.style.height = '100vh';
                window.style.margin = '0';
                showToast('Uygulama tam ekran yapıldı', 'info');
            }
        }
        // Keyboard Shortcuts
        document.addEventListener('keydown', function(e) {
            try {
                // Ctrl + S: Save/Sync
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    syncData();
                }
                
                // Ctrl + N: New Customer
                if (e.ctrlKey && e.key === 'n') {
                    e.preventDefault();
                    openCustomerModal();
                }
                
                // Escape: Close modals
                if (e.key === 'Escape') {
                    closeCustomerModal();
                    closeQuantityModal();
                }
                
                // F5: Refresh data
                if (e.key === 'F5') {
                    e.preventDefault();
                    location.reload();
                }
            } catch (error) {
                ErrorHandler.logError(error, 'keyboard shortcuts');
            }
        });
        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Check if user is already logged in
                const savedUser = DataManager.loadFromLocal('currentUser');
                if (savedUser) {
                    currentUser = savedUser;
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('appContainer').style.display = 'flex';
                    initializeApp();
                }
                
                // Set focus to username field
                document.getElementById('username').focus();
                
                showToast('ProClean Yönetim Sistemi yüklendi', 'success');
            } catch (error) {
                ErrorHandler.logError(error, 'app initialization');
                showToast('Uygulama yüklenirken hata oluştu', 'error');
            }
        });
        // Service Worker for offline functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                const swCode = `
                    const CACHE_NAME = 'proclean-v1';
                    const urlsToCache = [
                        '/',
                        '/style.css',
                        '/script.js'
                    ];
                    self.addEventListener('install', function(event) {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(function(cache) {
                                    return cache.addAll(urlsToCache);
                                })
                        );
                    });
                    self.addEventListener('fetch', function(event) {
                        event.respondWith(
                            caches.match(event.request)
                                .then(function(response) {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request);
                                })
                        );
                    });
                `;
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                navigator.serviceWorker.register(swUrl)
                    .then(function(registration) {
                        console.log('Service Worker registered successfully');
                    })
                    .catch(function(error) {
                        console.log('Service Worker registration 
              failed');
                    });
            });
        }
    </script>
</body>
</html>
