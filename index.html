<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ProClean - Profesyonel √áama≈üƒ±rhane Y√∂netim Sistemi</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <!-- ‚úÖ Local libraries -->
<script src="libs/JsBarcode.all.min.js"></script>
<script src="libs/jspdf.umd.min.js"></script>
<script src="libs/jspdf.plugin.autotable.min.js"></script>
<script src="libs/papaparse.min.js"></script>
<script src="libs/xlsx.full.min.js"></script>

    <script>
document.addEventListener("DOMContentLoaded", function() {
    const doc = new jsPDF();

    // Set font to Roboto Bold (from VFS)
    doc.setFont("Roboto", "bold");
    doc.setFontSize(16);

    // Test Turkish letters
    const testText = "√á, ≈û, ƒ∞, √ñ, √ú, ƒü, √º, ≈ü, √∂, √ß";
    doc.text(testText, 10, 20);

    /// Save PDF
    doc.save("test-turkish-font.pdf");
});
</script>

    </head>
<body>

    <div class="login-container" id="loginScreen">
    <div class="login-form">
        <h1>ProClean - Oturum A√ß</h1>
        
        <!-- Saved Accounts Section -->
        <div id="savedAccountsSection" style="display: none; margin-bottom: 20px;">
            <h3 style="margin-bottom: 10px; font-size: 14px; color: #666;">Kayƒ±tlƒ± Hesaplar</h3>
            <div id="savedAccountsList" class="saved-accounts-list">
                <!-- Saved accounts will appear here -->
            </div>
            <button type="button" class="btn-link" onclick="showManualLogin()" style="margin-top: 10px; font-size: 13px;">
                Farklƒ± hesapla giri≈ü yap
            </button>
        </div>
        
        <!-- Manual Login Form -->
        <div id="manualLoginSection">
            <div class="form-group">
                <label for="email">E-posta</label>
                <input type="email" id="email" placeholder="E-posta adresinizi girin" required>
                <div class="validation-error" id="emailError">Ge√ßerli bir e-posta adresi girin</div>
            </div>
            <div class="form-group">
                <label for="password">≈ûifre</label>
                <div style="position: relative;">
                    <input type="password" id="password" placeholder="≈ûifrenizi girin" required>
                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer;">
                        <i class="fas fa-eye" id="passwordToggleIcon"></i>
                    </button>
                </div>
                <div class="validation-error" id="passwordError">≈ûifre gereklidir</div>
            </div>
            
            <!-- Remember Me Checkbox -->
            <div class="form-group" style="display: flex; align-items: center; margin-bottom: 20px;">
                <input type="checkbox" id="rememberMe" style="margin-right: 8px; width: auto;">
                <label for="rememberMe" style="margin: 0; cursor: pointer; font-size: 14px;">
                    Beni hatƒ±rla
                </label>
            </div>
            
            <button type="button" class="btn btn-primary" id="loginBtn">Giri≈ü Yap</button>
            
            <button type="button" class="btn-link" onclick="showSavedAccounts()" id="showSavedAccountsBtn" style="margin-top: 10px; display: none; font-size: 13px;">
                Kayƒ±tlƒ± hesaplara d√∂n
            </button>
        </div>
    </div>
</div>

    <div class="app-container" id="appContainer" aria-hidden="true">
        <div class="app-header">
            <div class="app-title">ProClean - Profesyonel √áama≈üƒ±rhane Y√∂netim Sistemi</div>
            <div class="user-info">
                <span id="userRole">Operat√∂r: Y√ºkleniyor...</span>

                  <!-- Printer Status Indicator -->
<div id="printerIndicator" 
     class="printer-indicator" 
     style="
        border-radius: 4px; 
        padding: 4px 8px; 
        font-size: 0.9em; 
        display: inline-flex; 
        align-items: center; 
        gap: 5px;
        background-color: light-dark(#f8f9fa, #2b2b2b); 
        border: 1px solid light-dark(#dee2e6, #444); 
        color: light-dark(#212529, #f1f1f1);
     ">
    <i class="fas fa-print"></i>
    <span>Yazƒ±cƒ± Y√ºkleniyor...</span>
</div>

            
   <button id="settingsBtn" class="btn btn-secondary" onclick="showSettingsModal()">
    <i class="fas fa-cog"></i>
    <span>Ayarlar</span>
</button>

                
                <button onclick="logoutWithConfirmation()" class="btn btn-secondary">
    <i class="fas fa-sign-out-alt"></i> √áƒ±kƒ±≈ü Yap
</button>
            </div>
        </div>
                       <div class="printer-status-section">
    <div id="printer-status" class="printer-status">
        <span id="printer-indicator">üî¥</span>
        <span id="printer-text">Checking printer...</span>
        <button id="test-printer">Test Printer</button>
        <button onclick="checkPrinterStatus()">Check Status</button>
    </div>
</div>

        <div class="tabs" role="tablist" aria-label="Ana Sekmeler">
            <div class="tab active" data-tab="packaging" role="tab">Paketleme</div>
            <div class="tab" data-tab="shipping" role="tab">Sevkiyat</div>
            <div class="tab" data-tab="stock" role="tab">Stok Sorgu</div>
            <div class="tab admin-only" data-tab="reports" role="tab">Raporlar</div>
        </div>

        <div class="tab-content">
    <!-- Packaging Tab -->
    <div class="tab-pane active" id="packagingTab">
        <div class="packaging-header">
            <div class="customer-info">
                <div class="info-group">
                    <label for="customerSelect">M√º≈üteri Se√ßimi</label>
                    <select id="customerSelect" required>
                        <option value="">M√º≈üteri se√ßin...</option>
                    </select>
                    <div class="validation-error" id="customerError">M√º≈üteri se√ßimi zorunludur</div>
                </div>
                <div class="info-group">
                    <label for="personnelSelect">Personel</label>
                    <select id="personnelSelect" required>
                        <option value="">Personel se√ßin...</option>
                    </select>
                    <div class="validation-error" id="personnelError">Personel se√ßimi zorunludur</div>
                </div>
                <div class="info-group">
                    <label>Tarih</label>
                    <span id="currentDate">-</span>
                </div>
            </div>
            <div class="action-buttons">
                <button type="button" class="btn btn-primary" onclick="showAllCustomers()">M√º≈üteri Y√∂netimi</button>
                <button type="button" class="btn btn-warning" onclick="generateDailyReport()">ƒ∞≈ü Sonu Raporu</button>
                <button type="button" class="btn btn-success" onclick="sendToRamp()">Konteynere Ekle</button>
            </div>
        </div>

        <div class="packaging-content">
            <!-- LEFT COLUMN: Product Buttons Only -->
            <div class="barcode-section">
                <div class="quick-buttons">
                    <div class="quick-btn" onclick="openQuantityModal('B√ºy√ºk √áar≈üaf')" data-product="B√ºy√ºk √ßar≈üaf">
                        <span>B√ºy√ºk √ßar≈üaf</span>
                        <div class="quantity-badge" id="B√ºy√ºk √áar≈üaf-quantity">0</div>
                    </div>
                    <div class="quick-btn" onclick="openQuantityModal('√áar≈üaf')" data-product="√áar≈üaf">
                        <span>√áar≈üaf</span>
                        <div class="quantity-badge" id="√áar≈üaf-quantity">0</div>
                    </div>
                    <div class="quick-btn" onclick="openQuantityModal('B√ºy√ºk Nevresim')" data-product="B√ºy√ºk Nevresim">
                        <span>B√ºy√ºk Nevresim</span>
                        <div class="quantity-badge" id="B√ºy√ºk Nevresim-quantity">0</div>
                    </div>
                    <div class="quick-btn" onclick="openQuantityModal('Nevresim')" data-product="Nevresim">
                        <span>Nevresim</span>
                        <div class="quantity-badge" id="Nevresim-quantity">0</div>
                    </div>
                    <div class="quick-btn" onclick="openQuantityModal('B√ºy√ºk Havlu')" data-product="B√ºy√ºk Havlu">
                        <span>B√ºy√ºk Havlu</span>
                        <div class="quantity-badge" id="B√ºy√ºk Havlu-quantity">0</div>
                    </div>
                    <div class="quick-btn" onclick="openQuantityModal('Havlu')" data-product="Havlu">
                        <span>Havlu</span>
                        <div class="quantity-badge" id="Havlu-quantity">0</div>
                    </div>
                    <div class="quick-btn" onclick="openQuantityModal('Yastƒ±k')" data-product="Yastƒ±k">
                        <span>Yastƒ±k</span>
                        <div class="quantity-badge" id="Yastƒ±k-quantity">0</div>
                    </div>
                    <div class="quick-btn" onclick="openQuantityModal('Yastƒ±k Kƒ±lƒ±fƒ±')" data-product="Yastƒ±k Kƒ±lƒ±fƒ±">
                        <span>Yastƒ±k Kƒ±lƒ±fƒ±</span>
                        <div class="quantity-badge" id="Yastƒ±k Kƒ±lƒ±fƒ±-quantity">0</div>
                    </div>
                    <div class="quick-btn" onclick="openQuantityModal('Alez')" data-product="Alez">
                        <span>Alez</span>
                        <div class="quantity-badge" id="Alez-quantity">0</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 1rem;">
                    <button type="button" class="btn btn-primary" onclick="openManualEntry()" style="flex: 1;">Manuel Giri≈ü</button>
                    <button type="button" class="btn btn-secondary" onclick="openExtraModal()" style="flex: 1;">Extra</button>
                </div>

                <div class="status-buttons" style="display:flex; gap:0.5rem; margin-top:0.5rem;">
                    <div class="quick-btn status-btn" id="Lekeli" onclick="openStatusQuantityModal('Lekeli')" data-status="Lekeli">Lekeli</div>
                    <div class="quick-btn status-btn" id="Yƒ±rtƒ±k" onclick="openStatusQuantityModal('Yƒ±rtƒ±k')" data-status="Yƒ±rtƒ±k">Yƒ±rtƒ±k</div>
                    <div class="quick-btn status-btn" id="√áƒ±kmayan" onclick="openStatusQuantityModal('√áƒ±kmayan')" data-status="√áƒ±kmayan">√áƒ±kmayan</div>
                    <div class="quick-btn status-btn" id="Discard" onclick="openStatusQuantityModal('Discard')" data-status="Discard">Discard</div>
                </div>
            </div>

            <!-- MIDDLE COLUMN: Bekleyen Paketler Table -->
            <div class="pending-packages">
                <h3>Bekleyen Paketler</h3>
                <table class="package-table">
                    <thead>
                        <tr>
                            <th>
                                <input type="checkbox" id="selectAllPackages" onchange="toggleSelectAllPackages(this)">
                            </th>
                            <th>Paket No</th>
                            <th>M√º≈üteri</th>
                            <th>√úr√ºn</th>
                            <th>Adet</th>
                            <th>Tarih</th>
                            <th>Durum</th>
                            <th style="width: 60px;">Yazdƒ±r</th>
                        </tr>
                    </thead>
                    <tbody id="packagesTableBody">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>

            <!-- RIGHT COLUMN: Barcode + Package Details + Scanner Button -->
            <div class="package-details">
                <!-- Barcode Section at Top -->
                <h3>Barkod Okuma</h3>
                <div class="barcode-input">
                    <input type="text" id="barcodeInput" placeholder="Barkod okutun veya girin" autofocus>
                    <button type="button" onclick="processBarcode()"><i class="fas fa-search"></i></button>
                </div>
                <div id="barcodeResult">
                    <div id="scannedBarcodes" style="margin-top: 10px; max-height: 150px; overflow-y: auto;"></div>
                </div>

                <!-- Package Details Section -->
                <h3 style="margin-top: 1.5rem;">Paket Detaylarƒ±</h3>
                <div id="packageDetailContent">
                    <p style="text-align:center; color:#666; margin:2rem 0;">Paket se√ßin</p>
                </div>
                
                <div class="package-actions">
                    <button type="button" class="btn btn-success" onclick="completePackage()">Paketle</button>
                    <button type="button" class="btn btn-warning" id="printBarcodeBtn">Etiket Yazdƒ±r</button>
                    <button type="button" class="btn btn-danger" 
                        onclick="deletePackageWithAuth()" 
                        data-i18n="general.delete">Sil</button>

                    <!-- Scanner Button at Bottom -->
                    <button type="button" class="btn btn-secondary" onclick="toggleScannerMode()" style="width:100%; margin-top:1rem;" id="scannerToggle">
                        <i class="fas fa-camera"></i> Barkod Tarayƒ±cƒ±yƒ± A√ß
                    </button>
                </div>
            </div>
        </div>
    </div> <!-- End of packagingTab -->

    <!-- Shipping Tab -->
    <div class="tab-pane" id="shippingTab">
        <div class="packaging-header">
            <div class="customer-info">
                <div class="info-group">
                    <label for="shippingFilter">Durum Filtresi</label>
                    <select id="shippingFilter" onchange="filterShipping()">
                        <option value="all">T√ºm√º</option>
                        <option value="beklemede">Beklemede</option>
                        <option value="sevk-edildi">Sevk Edildi</option>
                    </select>
                </div>
                <div class="info-group">
                    <label for="containerSearch">Konteyner Ara</label>
                    <input type="text" id="containerSearch" placeholder="Konteyner no..." oninput="searchContainers()">
                </div>
            </div>
            <div class="action-buttons">
                <button type="button" class="btn btn-primary" onclick="createNewContainer()">Yeni Konteyner</button>
                <button type="button" class="btn btn-warning" onclick="loadCurrentContainer()">Mevcut Konteyner</button>
                <button type="button" class="btn btn-danger" onclick="deleteContainerWithAuth()">Konteyner Sil</button>
            </div>
        </div>

        <div id="shippingFolders">
            <!-- Customer folders will be populated here -->
        </div>
    </div> <!-- End of shippingTab -->

<!-- Find the Stock Tab section and replace with this: -->
<div class="tab-pane" id="stockTab">
    <div class="stock-header">
        <h2>RFID Stok Y√∂netimi</h2>
        <div class="stock-actions">
            <button id="startRFIDBtn" onclick="startRFIDScanner()" class="btn btn-success">
                <i class="fas fa-play"></i> RFID Tarayƒ±cƒ± Ba≈ülat
            </button>
            <button id="stopRFIDBtn" onclick="stopRFIDScanner()" class="btn btn-danger" disabled style="opacity: 0.5;">
                <i class="fas fa-stop"></i> Durdur
            </button>
            <button onclick="populateRFIDStockTable()" class="btn btn-primary">
                <i class="fas fa-sync"></i> Yenile
            </button>
            <button onclick="exportStock()" class="btn btn-secondary">
                <i class="fas fa-download"></i> Dƒ±≈üa Aktar
            </button>
        </div>
    </div>

    <div class="stock-content">
        <table class="stock-table">
            <thead>
                <tr>
                    <th>RFID Tag ID</th>
                    <th>Stok Kodu</th>
                    <th>√úr√ºn Adƒ±</th>
                    <th>M√º≈üteri</th>
                    <th>Durum</th>
                    <th>Adƒ±m</th>
                    <th>Kayƒ±t Tarihi</th>
                    <th>Yƒ±kanma Ya≈üƒ±</th>
                    <th>ƒ∞≈ülemler</th>
                </tr>
            </thead>
            <tbody id="stockTableBody">
                <tr>
                    <td colspan="9" style="text-align: center;">Stok y√ºkleniyor...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

    <!-- File Upload Section -->
    <div class="file-upload" style="margin-top:20px;">
        <h3>Stok Dosyasƒ± Y√ºkle / G√ºncelle</h3>
        <p>Excel (.xlsx, .xls) veya CSV (.csv) dosyasƒ± se√ßin</p>
        <input type="file" id="stockFileUpload" accept=".xlsx,.xls,.csv" onchange="document.getElementById('selectedFileName').textContent = this.files[0] ? this.files[0].name : ''">
        <div>
            <span id="selectedFileName"></span>
            <div class="validation-error" id="fileError"></div>
        </div>
        <button type="button" class="upload-button btn btn-primary" onclick="uploadStockFile()">
            <i class="fas fa-upload"></i> Dosya Y√ºkle
        </button>
        <button type="button" class="btn btn-secondary" onclick="downloadTemplate()" style="margin-left:10px;">
            <i class="fas fa-download"></i> ≈ûablon ƒ∞ndir
        </button>
    </div>
</div>


    <!-- Reports Tab -->
    <div class="tab-pane admin-only" id="reportsTab">
        <div class="packaging-header">
            <h3>Raporlar</h3>
            <div class="action-buttons">
                <button type="button" class="btn btn-primary" onclick="generateCustomReport()">√ñzel Rapor</button>
                <button type="button" class="btn btn-warning" onclick="exportReports()">Raporlarƒ± Dƒ±≈üa Aktar</button>
            </div>
        </div>

        <div class="report-filters" style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
            <div class="info-group">
                <label for="reportType">Rapor T√ºr√º</label>
                <select id="reportType">
                    <option value="daily">G√ºnl√ºk Rapor</option>
                    <option value="weekly">Haftalƒ±k Rapor</option>
                    <option value="monthly">Aylƒ±k Rapor</option>
                    <option value="custom">√ñzel Rapor</option>
                </select>
            </div>
            <div class="info-group">
                <label for="startDate">Ba≈ülangƒ±√ß Tarihi</label>
                <input type="date" id="startDate">
            </div>
            <div class="info-group">
                <label for="endDate">Biti≈ü Tarihi</label>
                <input type="date" id="endDate">
            </div>
            <div class="info-group" style="align-self: flex-end;">
                <button type="button" class="btn btn-primary" onclick="loadReports()">Raporlarƒ± Y√ºkle</button>
            </div>
        </div>

        <table class="stock-table">
            <thead>
                <tr>
                    <th>Rapor Tarihi</th>
                    <th>Rapor T√ºr√º</th>
                    <th>Paket Sayƒ±sƒ±</th>
                    <th>Toplam Adet</th>
                    <th>Olu≈üturan</th>
                    <th>ƒ∞≈ülemler</th>
                </tr>
            </thead>
            <tbody id="reportsTableBody">
                <!-- Reports will be populated here -->
            </tbody>
        </table>
    </div> <!-- End of reportsTab -->
</div> <!-- End of tab-content -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('üîç DEBUG: DOM loaded');
    
    // Wait a bit for everything to load
    setTimeout(() => {
        const btn = document.getElementById('printBarcodeBtn');
        console.log('üîç DEBUG: Button found?', btn);
        console.log('üîç DEBUG: Button listeners:', getEventListeners ? getEventListeners(btn) : 'Cannot check listeners');
        
        // Add a direct click listener to test
        if (btn) {
            btn.addEventListener('click', function() {
                console.log('üîç DEBUG: BUTTON CLICKED!');
            });
        }
        
        // Check if printer.js functions exist
        console.log('üîç DEBUG: printSelectedPackages exists?', typeof window.printSelectedPackages);
        console.log('üîç DEBUG: printerService exists?', typeof window.printerService);
        console.log('üîç DEBUG: electronAPI exists?', typeof window.electronAPI);
        
        // Check table
        const tbody = document.getElementById('packagesTableBody');
        console.log('üîç DEBUG: Table body found?', tbody);
        if (tbody) {
            const checkboxes = tbody.querySelectorAll('input[type="checkbox"]');
            console.log('üîç DEBUG: Checkboxes found:', checkboxes.length);
        }
    }, 1000);
});
</script>
                            
            <div class="tab-pane" id="shippingTab">
                <div class="packaging-header">
                    <div class="customer-info">
                        <div class="info-group">
                            <label for="shippingFilter">Durum Filtresi</label>
                            <select id="shippingFilter" onchange="filterShipping()">
                                <option value="all">T√ºm√º</option>
                                <option value="beklemede">Beklemede</option>
                                <option value="sevk-edildi">Sevk Edildi</option>
                            </select>
                        </div>
                        <div class="info-group">
                            <label for="containerSearch">Konteyner Ara</label>
                            <input type="text" id="containerSearch" placeholder="Konteyner no..." oninput="searchContainers()">
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button type="button" class="btn btn-primary" onclick="createNewContainer()">Yeni Konteyner</button>
                        <button type="button" class="btn btn-warning" onclick="loadCurrentContainer()">Mevcut Konteyner</button>
                       <button type="button" class="btn btn-danger" 
                      onclick="deleteContainerWithAuth()" 
                      data-i18n="shipping.delete.container">Konteyner Sil</button>
                    </div>
                </div>

                <div id="shippingFolders">
                    <!-- Customer folders will be populated here -->
                </div>
            </div>


            <td>
    <div class="edit-buttons" style="display: none;">
        <button onclick="saveStockFromRow(this, 'STK001')">Kaydet</button>
        <button onclick="cancelStockFromRow(this, 'STK001')">ƒ∞ptal</button>
    </div>
</td>
            

          <div class="tab-pane" id="stockTab">
                <div class="stock-search">
                    <input type="text" id="stockSearch" placeholder="Stok ara..." oninput="searchStock()">
                    <button type="button" class="btn btn-primary" onclick="clearStockSearch()">Temizle</button>
                    <button type="button" class="btn btn-success" onclick="exportStock()">Stoklarƒ± Dƒ±≈üa Aktar</button>
                </div>

                <table class="stock-table">
                    <thead>
                        <tr>
                            <th>Stok Kodu</th>
                            <th>√úr√ºn Adƒ±</th>
                            <th>Mevcut Adet</th>
                            <th>Birim</th>
                            <th>Durum</th>
                            <th>Son G√ºncelleme</th>
                            <th>ƒ∞≈ülemler</th>
                        </tr>
                    </thead>
                    <tbody id="stockTableBody">
                        <!-- Stock data will be populated here -->
                    </tbody>
                </table>



                <div class="file-upload">
                    <h3>Stok Dosyasƒ± Y√ºkle</h3>
                    <p>Excel (.xlsx, .xls) veya CSV (.csv) dosyasƒ± se√ßin</p>
                    <input type="file" id="stockFileUpload" accept=".xlsx,.xls,.csv" onchange="document.getElementById('selectedFileName').textContent = this.files[0] ? this.files[0].name : ''">
                    <div>
                        <span id="selectedFileName"></span>
                        <div class="validation-error" id="fileError"></div>
                    </div>
                    <button type="button" class="upload-button" onclick="uploadStockFile()">
                        <i class="fas fa-upload"></i> Dosya Y√ºkle
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="downloadTemplate()" style="margin-left: 10px;">
                        <i class="fas fa-download"></i> ≈ûablon ƒ∞ndir
                    </button>
                </div>
            </div>

            <div class="tab-pane admin-only" id="reportsTab">
                <div class="packaging-header">
                    <h3>Raporlar</h3>
                    <div class="action-buttons">
                        <button type="button" class="btn btn-primary" onclick="generateCustomReport()">√ñzel Rapor</button>
                        <button type="button" class="btn btn-warning" onclick="exportReports()">Raporlarƒ± Dƒ±≈üa Aktar</button>
                    </div>
                </div>

                <div class="report-filters" style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                    <div class="info-group">
                        <label for="reportType">Rapor T√ºr√º</label>
                        <select id="reportType">
                            <option value="daily">G√ºnl√ºk Rapor</option>
                            <option value="weekly">Haftalƒ±k Rapor</option>
                            <option value="monthly">Aylƒ±k Rapor</option>
                            <option value="custom">√ñzel Rapor</option>
                        </select>
                    </div>
                    <div class="info-group">
                        <label for="startDate">Ba≈ülangƒ±√ß Tarihi</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="info-group">
                        <label for="endDate">Biti≈ü Tarihi</label>
                        <input type="date" id="endDate">
                    </div>
                    <div class="info-group" style="align-self: flex-end;">
                        <button type="button" class="btn btn-primary" onclick="loadReports()">Raporlarƒ± Y√ºkle</button>
                    </div>
                </div>

                <table class="stock-table">
                    <thead>
                        <tr>
                            <th>Rapor Tarihi</th>
                            <th>Rapor T√ºr√º</th>
                            <th>Paket Sayƒ±sƒ±</th>
                            <th>Toplam Adet</th>
                            <th>Olu≈üturan</th>
                            <th>ƒ∞≈ülemler</th>
                        </tr>
                    </thead>
                    <tbody id="reportsTableBody">
                        <!-- Reports will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="app-footer">
            <div class="container-info">
                <span>Aktif Konteyner: <strong id="containerNumber">Yok</strong></span>
                <span>|</span>
                <span>Toplam Paket: <strong id="totalPackages">0</strong></span>
                <span>|</span>
                <span>ProClean ¬© 2025</span>
            </div>
            <div id="connectionStatus">√áevrimi√ßi</div>
        </div>
    </div>

    <!-- Alert container -->
    <div id="alertContainer" class="alert-container"></div>

    <!-- Customer Modal -->
    <div class="modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>M√º≈üteri Se√ß</h3>
                <button type="button" class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="customer-list" id="customerList">
                <!-- Customers will be populated here -->
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">ƒ∞ptal</button>
            </div>
        </div>
    </div>

    <!-- All Customers Modal -->
    <div class="modal" id="allCustomersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>M√º≈üteri Y√∂netimi</h3>
                <button type="button" class="modal-close" onclick="closeAllCustomersModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="newCustomerCode">M√º≈üteri Kodu</label>
                <input type="text" id="newCustomerCode" placeholder="√ñrn: P0005" required>
                <div class="validation-error" id="customerCodeError">M√º≈üteri kodu gereklidir</div>
            </div>
            <div class="form-group">
                <label for="newCustomerName">M√º≈üteri Adƒ±</label>
                <input type="text" id="newCustomerName" placeholder="M√º≈üteri adƒ±nƒ± girin" required>
                <div class="validation-error" id="customerNameError">M√º≈üteri adƒ± gereklidir</div>
            </div>
            <div class="form-group">
                <label for="newCustomerEmail">E-posta (ƒ∞steƒüe baƒülƒ±)</label>
                <input type="email" id="newCustomerEmail" placeholder="E-posta adresini girin">
                <div class="validation-error" id="customerEmailError">Ge√ßerli bir e-posta adresi girin</div>
            </div>
           <button type="button" class="btn btn-primary" 
        onclick="addCustomerWithAuth()" 
        data-i18n="customer.add">M√º≈üteri Ekle</button>
            
            <hr style="margin: 1.5rem 0;">
            <h4>Mevcut M√º≈üteriler</h4>
            <div class="customer-list" id="allCustomersList">
                <!-- All customers will be populated here -->
            </div>
        </div>
    </div>

    <!-- Email Modal -->
    <div class="modal" id="emailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ƒ∞≈ü Sonu Raporu G√∂nder</h3>
                <button type="button" class="modal-close" onclick="closeEmailModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="reportEmail">E-posta Adresi</label>
                <input type="email" id="reportEmail" placeholder="Rapor g√∂nderilecek e-posta" required>
                <div class="validation-error" id="reportEmailError">Ge√ßerli bir e-posta adresi girin</div>
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn btn-primary" onclick="sendDailyReport()">Rapor G√∂nder</button>
                <button type="button" class="btn btn-warning" onclick="previewReport()">√ñnizleme</button>
                <button type="button" class="btn btn-secondary" onclick="closeEmailModal()">ƒ∞ptal</button>
            </div>
        </div>
    </div>

    <!-- Quantity Modal -->
    <div class="quantity-modal" id="quantityModal">
        <div class="quantity-content">
            <h3 id="quantityModalTitle">Adet Girin</h3>
            <input type="number" id="quantityInput" class="quantity-input" min="1" placeholder="Adet" required>
            <div class="validation-error" id="quantityError">Ge√ßerli bir adet girin</div>
            <div class="quantity-buttons">
                <button type="button" class="btn btn-primary" onclick="confirmQuantity()">Onayla</button>
                <button type="button" class="btn btn-secondary" onclick="closeQuantityModal()">ƒ∞ptal</button>
            </div>
        </div>
    </div>

    <!-- Manual Entry Modal -->
    <div class="modal" id="manualModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Manuel √úr√ºn Giri≈üi</h3>
                <button type="button" class="modal-close" onclick="closeManualModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="manualProduct">√úr√ºn Adƒ±</label>
                <input type="text" id="manualProduct" placeholder="√úr√ºn adƒ±nƒ± girin" required>
                <div class="validation-error" id="manualProductError">√úr√ºn adƒ± gereklidir</div>
            </div>
            <div class="form-group">
                <label for="manualQuantity">Adet</label>
                <input type="number" id="manualQuantity" min="1" placeholder="Adet girin" required>
                <div class="validation-error" id="manualQuantityError">Ge√ßerli bir adet girin</div>
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn btn-primary" onclick="addManualProduct()">Ekle</button>
                <button type="button" class="btn btn-secondary" onclick="closeManualModal()">ƒ∞ptal</button>
            </div>
        </div>
    </div>


     <!-- Extra Products Modal -->
<div class="modal" id="extraModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Extra √úr√ºnler</h3>
            <button type="button" class="modal-close" onclick="closeExtraModal()">&times;</button>
        </div>

        <div class="quick-buttons">
            <div class="quick-btn" onclick="openQuantityModal('Paspas Havlu')">Paspas Havlu</div>
            <div class="quick-btn" onclick="openQuantityModal('Minik Havlu')">Minik Havlu</div>
            <div class="quick-btn" onclick="openQuantityModal('Pe≈ütemal')">Pe≈ütemal</div>
            <div class="quick-btn" onclick="openQuantityModal('Pornoz')">Pornoz</div>
            <div class="quick-btn" onclick="openQuantityModal('Pike')">Pike</div>
            <div class="quick-btn" onclick="openQuantityModal('Battaniye')">Battaniye</div>
            <div class="quick-btn" onclick="openQuantityModal('Yatak √ñrt√ºs√º')">Yatak √ñrt√ºs√º</div>
            <div class="quick-btn" onclick="openQuantityModal('T√ºl Perde')">T√ºl Perde</div>
            <div class="quick-btn" onclick="openQuantityModal('Kuma≈ü Perde')">Kuma≈ü Perde</div>
            <div class="quick-btn" onclick="openQuantityModal('Saten Perde')">Saten Perde</div>
        </div>
    </div>
</div>

    

    <!-- Container Detail Modal -->
    <div class="modal" id="containerDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="containerDetailTitle">Konteyner Detaylarƒ±</h3>
                <button type="button" class="modal-close" onclick="closeContainerDetailModal()">&times;</button>
            </div>
            <div id="containerDetailContent">
                <!-- Container details will be populated here -->
            </div>
            <div class="modal-buttons" style="margin-top: 20px;">
                <button type="button" class="btn btn-success" onclick="shipContainerFromModal()">Sevk Et</button>
                <button type="button" class="btn btn-secondary" onclick="closeContainerDetailModal()">Kapat</button>
            </div>
        </div>
    </div>

   <!-- Ayarlar Modalƒ± -->
<div class="modal" id="settingsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Ayarlar</h2>
            <button type="button" class="modal-close" id="closeSettingsModalBtn">&times;</button>
        </div>
        
        <!-- Genel Ayarlar -->
        <div class="settings-section">
            <h3>Genel Ayarlar</h3>
            
            <div class="settings-option">
                <label for="themeToggle">Tema Modu</label>
                <div class="toggle-switch">
                    <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
                    <label for="themeToggle" class="toggle-slider"></label>
                </div>
            </div>
            
            
            <div class="settings-option">
                <label for="autoSaveToggle">Otomatik Kaydet</label>
                <div class="toggle-switch">
                    <input type="checkbox" id="autoSaveToggle" checked onchange="toggleAutoSave()">
                    <label for="autoSaveToggle" class="toggle-slider"></label>
                    <span>5 saniyede bir</span>
                </div>
            </div>
        </div>


       <!-- Veri Y√∂netimi -->
<div class="settings-section">
    <h3>Veri Y√∂netimi</h3>
    
    <!-- Veri Yedekleme Section -->
    <div class="settings-option">
        <label>Veri Yedekleme</label>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button class="btn btn-primary" onclick="exportData('json')">
                <i class="fas fa-file-code"></i> JSON ƒ∞ndir
            </button>
            <button class="btn btn-primary" onclick="exportData('excel')">
                <i class="fas fa-file-excel"></i> Excel ƒ∞ndir
            </button>
            <button class="btn btn-primary" id="excelPreviewBtn" onclick="previewExcelData()" style="background-color: #217346; border-color: #217346; color: white;">
                <i class="fas fa-eye"></i> Excel √ñnizleme
            </button>
        </div>
    </div>

    <!-- Excel ƒ∞≈ülemleri Section -->
    <div class="settings-option">
        <label>Excel ƒ∞≈ülemleri</label>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button id="refreshExcelBtn" class="btn btn-secondary">
                <i class="fas fa-sync-alt"></i> G√ºncelle
            </button>
            <button id="clearExcelBtn" class="btn btn-danger">
                <i class="fas fa-trash"></i> Temizle
            </button>
        </div>
        <p style="font-size: 12px; color: #666; margin-top: 5px; margin-bottom: 0;">
            G√ºncelle: Verileri yeniler | Temizle: T√ºm Excel verilerini siler (≈üifre gerekli)
        </p>
    </div>
    
    <!-- Diƒüer Temizleme ƒ∞≈ülemleri -->
    <div class="settings-option">
        <label>Diƒüer Temizleme ƒ∞≈ülemleri</label>
        <button class="btn btn-danger" onclick="clearDataWithAuth()">
            <i class="fas fa-broom"></i> Yerel Verileri Temizle
        </button>
        <p style="font-size: 12px; color: #666; margin-top: 5px; margin-bottom: 0;">
            Uygulama √∂nbelleƒüini ve ge√ßici verileri temizler
        </p>
    </div>
</div>
        
        <!-- Sistem Bilgileri -->
        <div class="settings-section">
            <h3>Sistem Bilgileri</h3>
            
            <div class="settings-option">
                <label>Uygulama Versiyonu</label>
                <span class="system-info">v2.0.0</span>
            </div>
            
            <div class="settings-option">
                <label>Son G√ºncelleme</label>
                <span class="system-info" id="lastUpdateDate">-</span>
            </div>
            
            <div class="settings-option">
                <label>Veritabanƒ± Baƒülantƒ±sƒ±</label>
                <span id="dbConnectionStatus" class="status-indicator">Kontrol ediliyor...</span>
            </div>
            
            <div class="settings-option">
                <label>Yazƒ±cƒ± Durumu</label>
                <span id="printerConnectionStatus" class="status-indicator">Kontrol ediliyor...</span>
            </div>
        </div>

        <!-- Geli≈ütirici Se√ßenekleri (Admin only) -->
        <div class="settings-section admin-only">
            <h3>Geli≈ütirici Se√ßenekleri</h3>
            
            <div class="settings-option">
                <label>Hata Ayƒ±klama Modu</label>
                <div class="toggle-switch">
                    <input type="checkbox" id="debugModeToggle" onchange="toggleDebugMode()">
                    <label for="debugModeToggle" class="toggle-slider"></label>
                </div>
            </div>
            
            <div class="settings-option">
                <label>Konsol Loglarƒ±</label>
                <button class="btn btn-secondary" onclick="showConsoleLogs()">Loglarƒ± G√∂r√ºnt√ºle</button>
            </div>
            
            <div class="settings-option">
                <label>Performans Testi</label>
                <button class="btn btn-secondary" onclick="runPerformanceTest()">Test √áalƒ±≈ütƒ±r</button>
            </div>
        </div>

        <div class="modal-buttons" style="margin-top: 20px;">
            <button type="button" class="btn btn-success" onclick="saveAllSettings()">T√ºm Ayarlarƒ± Kaydet</button>
            <button type="button" class="btn btn-secondary" onclick="closeSettingsModal()">Kapat</button>
        </div>
    </div>
</div>

    

    <!-- Print Label Container (hidden) -->
    <div id="printContainer" style="display:none;"></div>
    
    
    <div class="toast" id="toast" role="status" aria-live="polite"></div>
    <div class="offline-indicator" id="offlineIndicator">√áevrimdƒ±≈üƒ± Mod</div>

<!-- 1. External libraries and database connection first -->
<script src="js/passwordGuard.js"></script>

<!-- Workspace manager scripts-->
<script src="js/workspace-manager.js"></script>
<script src="js/workspace-utilities.js"></script> 
    
   <!--- Server Related Scripts-->
<script src="js/supabase.js"></script>

    
<!-- 2. UI functions (needed by other modules) -->
<script src="js/ui.js"></script>
            
<!-- 3. PRINTER BEFORE AUTH (so it loads even if auth fails) -->
<script src="js/printer.js"></script>
            
<!-- 4. Authentication (depends on supabase and ui) -->
<script src="js/auth.js"></script>
<!-- 5. Core application logic (depends on supabase, ui, auth) -->
<script src="js/reports.js"></script>
<script src="js/storage.js"></script>
           
<!-- 6. Feature modules (depend on core functionality) -->
<script src="js/stock.js"></script>
<script src="js/darkMode.js"></script> 
<script src="js/app.js"></script>
    <script>
function getCustomEventListeners(element) {
    if (!element || typeof element.addEventListener !== 'function') {
        return {};
    }
    // Yaygƒ±n olarak kullanƒ±lan olaylarƒ± kontrol edin
    const eventTypes = ['click', 'change', 'submit', 'input', 'keydown', 'keypress', 'keyup'];
    const listeners = {};

    eventTypes.forEach(type => {
        const inlineListener = element[`on${type}`];
        if (inlineListener) {
            listeners[type] = [{ handler: inlineListener.toString() }];
        }
    });

    if (Object.keys(listeners).length === 0) {
        return "No direct inline or 'on[event]' listeners found. Check the element in DevTools for 'addEventListener' listeners.";
    }
    
    return listeners;
}
// Global scope'a ekliyoruz, ancak tarayƒ±cƒ± konsolu dƒ±≈üƒ±nda √ßaƒüƒ±rmayƒ±n.
window.getEventListenersCustom = getCustomEventListeners;
console.log("‚úÖ getEventListenersCustom (Simulated Debug Function) loaded.");
</script>


    
<script>
(function() {
  // Wait for StorageManager to be available
  function waitForStorage(callback) {
    if (window.StorageManager) {
      callback();
    } else {
      console.log('Waiting for StorageManager...');
      setTimeout(() => waitForStorage(callback), 100);
    }
  }
  
  waitForStorage(function() {
    console.log('StorageManager ready, initializing Remember Me');
    initRememberMe();
  });
  
  function initRememberMe() {
    window.addEventListener('DOMContentLoaded', async function() {
      setTimeout(async () => {
        const accounts = await RememberMeStorage.getAccounts();
        if (accounts.length > 0) displayAccounts(accounts);
      }, 500);
      
      const btn = document.getElementById('loginBtn');
      if (btn) {
        const orig = btn.onclick;
        btn.onclick = async function(e) {
          if (orig) await orig.call(this, e);
          setTimeout(checkSave, 1000);
        };
      }
    });
  }
  
  async function checkSave() {
    const app = document.getElementById('appContainer');
    if (app?.style.display === 'flex') {
      const email = document.getElementById('email').value;
      const pass = document.getElementById('password').value;
      const remember = document.getElementById('rememberMe');
      if (email && pass && remember?.checked) {
        await RememberMeStorage.saveAccount(email, pass);
      }
    }
  }
  
  function displayAccounts(accounts) {
    const list = document.getElementById('savedAccountsList');
    if (!list) return;
    list.innerHTML = '';
    accounts.forEach(acc => {
      const div = document.createElement('div');
      div.className = 'saved-account-item';
      div.innerHTML = `
        <div class="saved-account-info" onclick="quickLogin('${acc.email}')">
          <div class="account-avatar">${acc.avatar}</div>
          <div class="account-details">
            <span class="account-email">${acc.email}</span>
            <span class="account-last-login">${timeAgo(acc.lastLogin)}</span>
          </div>
        </div>
        <button class="account-remove" onclick="removeAcc('${acc.email}', event)">
          <i class="fas fa-times"></i>
        </button>
      `;
      list.appendChild(div);
    });
    document.getElementById('savedAccountsSection').style.display = 'block';
    document.getElementById('manualLoginSection').style.display = 'none';
  }
  
  window.quickLogin = async function(email) {
    const acc = await RememberMeStorage.getAccount(email);
    if (acc) {
      document.getElementById('email').value = email;
      document.getElementById('password').value = atob(acc.password);
      document.getElementById('loginBtn').click();
    }
  };
  
  window.removeAcc = async function(email, e) {
    e.stopPropagation();
    if (confirm(`${email} kaldƒ±rƒ±lsƒ±n mƒ±?`)) {
      await RememberMeStorage.removeAccount(email);
      const accs = await RememberMeStorage.getAccounts();
      accs.length === 0 ? (
        document.getElementById('savedAccountsSection').style.display = 'none',
        document.getElementById('manualLoginSection').style.display = 'block'
      ) : displayAccounts(accs);
    }
  };
  
  window.showManualLogin = () => {
    document.getElementById('savedAccountsSection').style.display = 'none';
    document.getElementById('manualLoginSection').style.display = 'block';
  };
  
  window.showSavedAccounts = async () => displayAccounts(await RememberMeStorage.getAccounts());
  
  window.togglePasswordVisibility = () => {
    const input = document.getElementById('password');
    const icon = document.getElementById('passwordToggleIcon');
    input.type = input.type === 'password' ? 'text' : 'password';
    icon.className = 'fas fa-eye' + (input.type === 'text' ? '-slash' : '');
  };
  
  function timeAgo(d) {
    const m = Math.floor((Date.now() - new Date(d)) / 60000);
    return m < 1 ? 'Az √∂nce' : m < 60 ? m + ' dk' : Math.floor(m/60) + ' saat';
  }
})();
</script>
            
</body>
</html>
