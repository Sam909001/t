<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ProClean - Profesyonel Çamaşırhane Yönetim Sistemi</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
    
    <!-- Local Libraries -->
    <script src="libs/JsBarcode.all.min.js"></script>
    <script src="libs/jspdf.umd.min.js"></script>
    <script src="libs/jspdf.plugin.autotable.min.js"></script>
    <script src="libs/papaparse.min.js"></script>
    <script src="libs/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-form">
            <h1><i class="fas fa-tshirt"></i> ProClean</h1>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">E-posta</label>
                    <input type="email" id="email" required>
                    <div id="emailError" class="error-message"></div>
                </div>
                <div class="form-group">
                    <label for="password">Şifre</label>
                    <input type="password" id="password" required>
                    <div id="passwordError" class="error-message"></div>
                </div>
                <button type="submit" id="loginBtn" class="btn btn-primary" style="width: 100%;">Giriş Yap</button>
            </form>
            <button id="apiKeyBtn" class="btn btn-link" style="margin-top: 1rem; width: 100%;">API Anahtarını Ayarla</button>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appContainer" class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="app-title">
                <i class="fas fa-tshirt"></i> ProClean
            </div>
            <div class="user-info">
                <span id="userRole">Yükleniyor...</span>
                <button id="settingsBtn" class="btn"><i class="fas fa-cog"></i></button>
                <button id="logoutBtn" class="btn"><i class="fas fa-sign-out-alt"></i> Çıkış</button>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tabs">
            <div class="tab active" data-tab="packaging">
                <i class="fas fa-box"></i> Paketleme
            </div>
            <div class="tab" data-tab="shipping">
                <i class="fas fa-truck"></i> Sevkiyat
            </div>
            <div class="tab" data-tab="stock">
                <i class="fas fa-warehouse"></i> Stok
            </div>
            <div class="tab admin-only" data-tab="customers">
                <i class="fas fa-users"></i> Müşteriler
            </div>
            <div class="tab admin-only" data-tab="reports">
                <i class="fas fa-chart-bar"></i> Raporlar
            </div>
        </nav>

        <!-- Tab Content -->
        <main class="tab-content">
            <!-- Packaging Tab -->
            <div id="packagingTab" class="tab-pane active">
                <div class="packaging-header">
                    <div class="customer-info">
                        <div class="info-group">
                            <label>Müşteri</label>
                            <select id="customerSelect">
                                <option value="">Müşteri Seçin</option>
                            </select>
                        </div>
                        <div class="info-group">
                            <label>Personel</label>
                            <select id="personnelSelect">
                                <option value="">Personel Seçin</option>
                            </select>
                        </div>
                        <div class="info-group">
                            <label>Tarih</label>
                            <span id="currentDate"></span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button id="newContainerBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Yeni Konteyner
                        </button>
                        <button id="printLabelsBtn" class="btn btn-warning">
                            <i class="fas fa-print"></i> Etiket Yazdır
                        </button>
                    </div>
                </div>

                <div class="packaging-content">
                    <div class="barcode-section">
                        <h3><i class="fas fa-qrcode"></i> Barkod Okuyucu</h3>
                        <div class="barcode-input">
                            <input type="text" id="barcodeInput" placeholder="Barkod okutun veya yazın">
                            <button id="barcodeSubmit"><i class="fas fa-search"></i></button>
                        </div>
                        <div id="scannedBarcodes" class="scanned-list"></div>
                        <div class="quick-buttons" id="quickButtons"></div>
                        <button id="scannerToggle" class="btn btn-secondary" style="width: 100%; margin-top: 1rem;">
                            <i class="fas fa-camera"></i> Kamera Tarayıcı
                        </button>
                    </div>

                    <div class="pending-packages">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3><i class="fas fa-clock"></i> Bekleyen Paketler</h3>
                            <div>
                                <input type="checkbox" id="selectAllPackages"> Tümünü Seç
                            </div>
                        </div>
                        <table class="package-table">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>Müşteri</th>
                                    <th>Ürün</th>
                                    <th>Adet</th>
                                    <th>Durum</th>
                                    <th>İşlemler</th>
                                </tr>
                            </thead>
                            <tbody id="packagesTableBody"></tbody>
                        </table>
                    </div>

                    <div class="package-details">
                        <h3><i class="fas fa-info-circle"></i> Paket Detayları</h3>
                        <div id="packageDetailContent">
                            <p>Paket seçin...</p>
                        </div>
                        <div class="package-actions">
                            <button id="printPackageBtn" class="btn btn-success" disabled>
                                <i class="fas fa-print"></i> Yazdır
                            </button>
                            <button id="editPackageBtn" class="btn btn-warning" disabled>
                                <i class="fas fa-edit"></i> Düzenle
                            </button>
                            <button id="deletePackageBtn" class="btn btn-danger" disabled>
                                <i class="fas fa-trash"></i> Sil
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shipping Tab -->
            <div id="shippingTab" class="tab-pane">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2><i class="fas fa-truck"></i> Sevkiyat Klasörleri</h2>
                    <div>
                        <select id="shippingFilter">
                            <option value="">Tüm Durumlar</option>
                            <option value="beklemede">Beklemede</option>
                            <option value="sevk-edildi">Sevk Edildi</option>
                        </select>
                        <button id="markAsShippedBtn" class="btn btn-success">
                            <i class="fas fa-check"></i> Sevk Edildi İşaretle
                        </button>
                    </div>
                </div>
                <div id="shippingFolders" class="shipping-container"></div>
            </div>

            <!-- Stock Tab -->
            <div id="stockTab" class="tab-pane">
                <div class="stock-search">
                    <input type="text" id="stockSearch" placeholder="Stok ara...">
                    <button id="addStockBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Stok Ekle
                    </button>
                    <button id="exportStockBtn" class="btn btn-secondary">
                        <i class="fas fa-download"></i> Dışa Aktar
                    </button>
                </div>
                <table class="stock-table">
                    <thead>
                        <tr>
                            <th>Ürün Kodu</th>
                            <th>Ürün Adı</th>
                            <th>Stok Miktarı</th>
                            <th>Minimum Stok</th>
                            <th>Durum</th>
                            <th>Son Güncelleme</th>
                            <th>İşlemler</th>
                        </tr>
                    </thead>
                    <tbody id="stockTableBody"></tbody>
                </table>
                <div class="file-upload">
                    <h3>Toplu Stok Yükleme</h3>
                    <input type="file" id="stockFileInput" accept=".csv,.xlsx" style="display: none;">
                    <label for="stockFileInput" class="upload-button">
                        <i class="fas fa-upload"></i> Dosya Seç
                    </label>
                    <p style="margin-top: 0.5rem; color: #666; font-size: 0.9rem;">
                        CSV veya Excel dosyası yükleyebilirsiniz
                    </p>
                </div>
            </div>

            <!-- Customers Tab -->
            <div id="customersTab" class="tab-pane">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2><i class="fas fa-users"></i> Müşteri Yönetimi</h2>
                    <div>
                        <input type="text" id="customerSearch" placeholder="Müşteri ara...">
                        <button id="addCustomerBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Müşteri Ekle
                        </button>
                    </div>
                </div>
                <div id="allCustomersList" class="customers-grid"></div>
            </div>

            <!-- Reports Tab -->
            <div id="reportsTab" class="tab-pane">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2><i class="fas fa-chart-bar"></i> Raporlar</h2>
                    <div>
                        <input type="date" id="reportStartDate">
                        <input type="date" id="reportEndDate">
                        <button id="generateReportBtn" class="btn btn-primary">
                            <i class="fas fa-chart-line"></i> Rapor Oluştur
                        </button>
                    </div>
                </div>
                <div id="reportContent" class="report-container"></div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="container-info">
                <span>Konteyner: <span id="containerNumber">-</span></span>
                <span>Toplam Paket: <span id="totalPackages">0</span></span>
                <span id="connectionStatus" class="connection-status">Bağlantı durumu kontrol ediliyor...</span>
            </div>
            <div>
                <span>ProClean v2.0 © 2024</span>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Müşteri Seç</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div id="customerList" class="customer-list"></div>
        </div>
    </div>

    <div id="quantityModal" class="quantity-modal">
        <div class="quantity-content">
            <h3 id="quantityModalTitle">Adet Girin</h3>
            <input type="number" id="quantityInput" class="quantity-input" min="1" value="1">
            <div class="quantity-buttons">
                <button id="confirmQuantity" class="btn btn-success">Onayla</button>
                <button id="cancelQuantity" class="btn btn-danger">İptal</button>
            </div>
        </div>
    </div>

    <div id="apiKeyModal" class="api-key-modal">
        <div class="api-key-content">
            <h3>Supabase API Anahtarı</h3>
            <p>Lütfen Supabase anon anahtarınızı girin:</p>
            <input type="text" id="apiKeyInput" class="api-key-input" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem;">
                <button id="saveApiKey" class="btn btn-primary">Kaydet</button>
                <button id="cancelApiKey" class="btn btn-danger">İptal</button>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ayarlar</h3>
                <button id="closeSettingsModalBtn" class="modal-close">&times;</button>
            </div>
            <div class="settings-content">
                <div class="setting-group">
                    <h4>Görünüm</h4>
                    <label>
                        <input type="checkbox" id="themeToggle"> Koyu Tema
                    </label>
                </div>
                <div class="setting-group">
                    <h4>Yazdırma</h4>
                    <label>Ölçeklendirme:</label>
                    <select id="printerScaling">
                        <option value="100%">100%</option>
                        <option value="125%">125%</option>
                        <option value="150%">150%</option>
                    </select>
                    <label>Kopya Sayısı:</label>
                    <input type="number" id="copiesNumber" min="1" max="10" value="1">
                </div>
                <div class="setting-group">
                    <h4>Sistem</h4>
                    <label>
                        <input type="checkbox" id="autoSaveToggle" checked> Otomatik Kaydet
                    </label>
                    <div class="status-indicators">
                        <div>DB Bağlantısı: <span id="dbConnectionStatus" class="status-indicator"></span></div>
                        <div>Yazıcı: <span id="printerConnectionStatus" class="status-indicator"></span></div>
                    </div>
                </div>
                <div class="setting-actions">
                    <button id="saveAllSettings" class="btn btn-primary">Ayarları Kaydet</button>
                    <button id="exportData" class="btn btn-secondary">Verileri Dışa Aktar</button>
                    <button id="clearLocalData" class="btn btn-danger">Yerel Verileri Temizle</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Offline Indicator -->
    <div id="offlineIndicator" class="offline-indicator">
        <i class="fas fa-wifi"></i> Çevrimdışı Mod
    </div>

    <!-- Alert Container -->
    <div id="alertContainer" style="position: fixed; top: 20px; right: 20px; z-index: 10000;"></div>

 <!-- Core utilities first -->
<script src="src/utils/helpers.js"></script>
<script src="src/utils/notifications.js"></script>
<script src="src/utils/validation.js"></script>
<script src="src/utils/offline.js"></script>

<!-- Database layer -->
<script src="src/database/index.js"></script>
<script src="src/database/auth.js"></script>
<script src="src/database/customers.js"></script>
<script src="src/database/packages.js"></script>
<script src="src/database/stock.js"></script>
<script src="src/database/reports.js"></script>
<script src="src/database/containers.js"></script>

<!-- UI components -->
<script src="src/ui/modals.js"></script>
<script src="src/ui/tabs.js"></script>
<script src="src/ui/tables.js"></script>

<!-- Printing and barcode -->
<script src="src/printing/printer.js"></script>
<script src="src/printing/barcode.js"></script>

<!-- Main application - load last -->
<script src="src/app.js"></script>pt>
</body>
</html>
